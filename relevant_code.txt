### FILE: src/app/Http/Controllers/AdminController.php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\User;
use App\Models\Restaurant;
use App\Models\Review;
use Illuminate\Support\Facades\Auth;

class AdminController extends Controller
{
    /**
     * 管理者ダッシュボード表示
     */
    public function index()
    {
        // 最新のデータを取得（必要に応じてページネーションに変更可）
        $users = User::latest()->get();
        $restaurants = Restaurant::with('user')->latest()->get();
        $reviews = Review::with(['user', 'restaurant'])->latest()->get();

        return view('admin.dashboard', compact('users', 'restaurants', 'reviews'));
    }

    /**
     * ユーザー削除
     */
    public function destroyUser($id)
    {
        // 自分自身は削除できないようにする
        if ($id == Auth::id()) {
            return back()->with('error', '自分自身は削除できません。');
        }

        User::destroy($id);
        return back()->with('success', 'ユーザーを削除しました。');
    }

    /**
     * 店舗削除
     */
    public function destroyRestaurant($id)
    {
        Restaurant::destroy($id);
        return back()->with('success', '店舗を削除しました。');
    }

    /**
     * レビュー削除
     */
    public function destroyReview($id)
    {
        Review::destroy($id);
        return back()->with('success', 'レビューを削除しました。');
    }
}

### FILE: src/app/Http/Controllers/Auth/AuthenticatedSessionController.php
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use App\Http\Requests\Auth\LoginRequest;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\View\View;

class AuthenticatedSessionController extends Controller
{
    /**
     * Display the login view.
     */
    public function create(): View
    {
        return view('auth.login');
    }

    /**
     * Handle an incoming authentication request.
     */
    public function store(LoginRequest $request): RedirectResponse
    {
        $request->authenticate();

        $request->session()->regenerate();

        $user = $request->user();

        // 1. 管理者 (role_id = 3) なら管理者ダッシュボードへ
        if ($user->role_id === 3) {
            return redirect()->intended(route('admin.dashboard'));
        }

        // 2. 店舗代表者 (role_id = 2) なら一般ダッシュボード（または店舗管理画面）へ
        // ※今は一般と同じdashboardですが、分けたい場合はここを変えます
        if ($user->role_id === 2) {
             return redirect()->intended(route('dashboard'));
        }

        // 3. 一般ユーザー (role_id = 1) ならトップページ、または直前のページへ
        return redirect()->intended(route('home'));

        return redirect()->intended(route('dashboard', absolute: false));
    }

    /**
     * Destroy an authenticated session.
     */
    public function destroy(Request $request): RedirectResponse
    {
        Auth::guard('web')->logout();

        $request->session()->invalidate();

        $request->session()->regenerateToken();

        // ★ここを書き換えました
        return redirect()->route('restaurants.index');
    }
}


### FILE: src/app/Http/Controllers/Auth/ConfirmablePasswordController.php
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Validation\ValidationException;
use Illuminate\View\View;

class ConfirmablePasswordController extends Controller
{
    /**
     * Show the confirm password view.
     */
    public function show(): View
    {
        return view('auth.confirm-password');
    }

    /**
     * Confirm the user's password.
     */
    public function store(Request $request): RedirectResponse
    {
        if (! Auth::guard('web')->validate([
            'email' => $request->user()->email,
            'password' => $request->password,
        ])) {
            throw ValidationException::withMessages([
                'password' => __('auth.password'),
            ]);
        }

        $request->session()->put('auth.password_confirmed_at', time());

        return redirect()->intended(route('dashboard', absolute: false));
    }
}


### FILE: src/app/Http/Controllers/Auth/EmailVerificationNotificationController.php
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;

class EmailVerificationNotificationController extends Controller
{
    /**
     * Send a new email verification notification.
     */
    public function store(Request $request): RedirectResponse
    {
        if ($request->user()->hasVerifiedEmail()) {
            return redirect()->intended(route('dashboard', absolute: false));
        }

        $request->user()->sendEmailVerificationNotification();

        return back()->with('status', 'verification-link-sent');
    }
}


### FILE: src/app/Http/Controllers/Auth/EmailVerificationPromptController.php
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\View\View;

class EmailVerificationPromptController extends Controller
{
    /**
     * Display the email verification prompt.
     */
    public function __invoke(Request $request): RedirectResponse|View
    {
        return $request->user()->hasVerifiedEmail()
                    ? redirect()->intended(route('dashboard', absolute: false))
                    : view('auth.verify-email');
    }
}


### FILE: src/app/Http/Controllers/Auth/NewPasswordController.php
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use App\Models\User;
use Illuminate\Auth\Events\PasswordReset;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Facades\Password;
use Illuminate\Support\Str;
use Illuminate\Validation\Rules;
use Illuminate\View\View;

class NewPasswordController extends Controller
{
    /**
     * Display the password reset view.
     */
    public function create(Request $request): View
    {
        return view('auth.reset-password', ['request' => $request]);
    }

    /**
     * Handle an incoming new password request.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    public function store(Request $request): RedirectResponse
    {
        $request->validate([
            'token' => ['required'],
            'email' => ['required', 'email'],
            'password' => ['required', 'confirmed', Rules\Password::defaults()],
        ]);

        // Here we will attempt to reset the user's password. If it is successful we
        // will update the password on an actual user model and persist it to the
        // database. Otherwise we will parse the error and return the response.
        $status = Password::reset(
            $request->only('email', 'password', 'password_confirmation', 'token'),
            function (User $user) use ($request) {
                $user->forceFill([
                    'password' => Hash::make($request->password),
                    'remember_token' => Str::random(60),
                ])->save();

                event(new PasswordReset($user));
            }
        );

        // If the password was successfully reset, we will redirect the user back to
        // the application's home authenticated view. If there is an error we can
        // redirect them back to where they came from with their error message.
        return $status == Password::PASSWORD_RESET
                    ? redirect()->route('login')->with('status', __($status))
                    : back()->withInput($request->only('email'))
                        ->withErrors(['email' => __($status)]);
    }
}


### FILE: src/app/Http/Controllers/Auth/PasswordController.php
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Hash;
use Illuminate\Validation\Rules\Password;

class PasswordController extends Controller
{
    /**
     * Update the user's password.
     */
    public function update(Request $request): RedirectResponse
    {
        $validated = $request->validateWithBag('updatePassword', [
            'current_password' => ['required', 'current_password'],
            'password' => ['required', Password::defaults(), 'confirmed'],
        ]);

        $request->user()->update([
            'password' => Hash::make($validated['password']),
        ]);

        return back()->with('status', 'password-updated');
    }
}


### FILE: src/app/Http/Controllers/Auth/PasswordResetLinkController.php
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Password;
use Illuminate\View\View;

class PasswordResetLinkController extends Controller
{
    /**
     * Display the password reset link request view.
     */
    public function create(): View
    {
        return view('auth.forgot-password');
    }

    /**
     * Handle an incoming password reset link request.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    public function store(Request $request): RedirectResponse
    {
        $request->validate([
            'email' => ['required', 'email'],
        ]);

        // We will send the password reset link to this user. Once we have attempted
        // to send the link, we will examine the response then see the message we
        // need to show to the user. Finally, we'll send out a proper response.
        $status = Password::sendResetLink(
            $request->only('email')
        );

        return $status == Password::RESET_LINK_SENT
                    ? back()->with('status', __($status))
                    : back()->withInput($request->only('email'))
                        ->withErrors(['email' => __($status)]);
    }
}


### FILE: src/app/Http/Controllers/Auth/RegisteredUserController.php
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use App\Models\User;
use Illuminate\Auth\Events\Registered;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Hash;
use Illuminate\Validation\Rules;
use Illuminate\View\View;

class RegisteredUserController extends Controller
{
    /**
     * Display the registration view.
     */
    public function create(): View
    {
        return view('auth.register');
    }

    /**
     * Handle an incoming registration request.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    // ... use宣言などはそのままでOK ...

public function store(Request $request): RedirectResponse
{
    $request->validate([
        'name' => ['required', 'string', 'max:255'],
        'email' => ['required', 'string', 'lowercase', 'email', 'max:255', 'unique:'.User::class],
        'password' => ['required', 'confirmed', Rules\Password::defaults()],
        'role_id' => ['required', 'integer', 'in:1,2'], // ★追加：1か2のみ許可
    ]);

    $user = User::create([
        'name' => $request->name,
        'email' => $request->email,
        'password' => Hash::make($request->password),
        'role_id' => $request->role_id, // ★追加：DBに保存
    ]);

    event(new Registered($user));

    Auth::login($user);

    return redirect(route('dashboard', absolute: false));
}
}

### FILE: src/app/Http/Controllers/Auth/VerifyEmailController.php
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Auth\Events\Verified;
use Illuminate\Foundation\Auth\EmailVerificationRequest;
use Illuminate\Http\RedirectResponse;

class VerifyEmailController extends Controller
{
    /**
     * Mark the authenticated user's email address as verified.
     */
    public function __invoke(EmailVerificationRequest $request): RedirectResponse
    {
        if ($request->user()->hasVerifiedEmail()) {
            return redirect()->intended(route('dashboard', absolute: false).'?verified=1');
        }

        if ($request->user()->markEmailAsVerified()) {
            event(new Verified($request->user()));
        }

        return redirect()->intended(route('dashboard', absolute: false).'?verified=1');
    }
}


### FILE: src/app/Http/Controllers/Controller.php
<?php

namespace App\Http\Controllers;

abstract class Controller
{
    //
}


### FILE: src/app/Http/Controllers/FavoriteController.php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;

class FavoriteController extends Controller
{
    // お気に入り登録
    public function store($restaurantId)
    {
        $user = Auth::user();

        // 重複チェック：まだ登録していなければ作成する
        if (!$user->favorites()->where('restaurant_id', $restaurantId)->exists()) {
            // ★修正ポイント：attach() ではなく create() を使います
            $user->favorites()->create([
                'restaurant_id' => $restaurantId
            ]);
        }

        return back(); // 元の画面に戻る
    }

    // お気に入り解除
    public function destroy($restaurantId)
    {
        $user = Auth::user();

        // ★修正ポイント：detach() ではなく delete() を使います
        $user->favorites()->where('restaurant_id', $restaurantId)->delete();

        return back();
    }
}

### FILE: src/app/Http/Controllers/OwnerController.php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Restaurant;
use App\Models\Reservation;
use Carbon\Carbon;

class OwnerController extends Controller
{
    public function dashboard(Restaurant $restaurant)
    {
        // 今日の日付を取得
        $today = Carbon::today();

        // 未来の予約を取得（過去のものは今回は表示しない）
        // with()を使うことで、user情報とseatType情報を一度に取ってくる（高速化）
        $reservations = Reservation::with(['user', 'seatType'])
            ->where('restaurant_id', $restaurant->id)
            ->where('reserved_at', '>=', $today) // 今日以降
            ->orderBy('reserved_at', 'asc')       // 日付が近い順
            ->get();

        return view('owner.dashboard', compact('restaurant', 'reservations'));
    }
}

### FILE: src/app/Http/Controllers/ProfileController.php
<?php

namespace App\Http\Controllers;

use App\Http\Requests\ProfileUpdateRequest;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Redirect;
use Illuminate\View\View;

class ProfileController extends Controller
{
    /**
     * Display the user's profile form.
     */
    public function edit(Request $request): View
    {
        return view('profile.edit', [
            'user' => $request->user(),
        ]);
    }

    /**
     * Update the user's profile information.
     */
    public function update(ProfileUpdateRequest $request): RedirectResponse
    {
        $request->user()->fill($request->validated());

        if ($request->user()->isDirty('email')) {
            $request->user()->email_verified_at = null;
        }

        $request->user()->save();

        return Redirect::route('profile.edit')->with('status', 'profile-updated');
    }

    /**
     * Delete the user's account.
     */
    public function destroy(Request $request): RedirectResponse
    {
        $request->validateWithBag('userDeletion', [
            'password' => ['required', 'current_password'],
        ]);

        $user = $request->user();

        Auth::logout();

        $user->delete();

        $request->session()->invalidate();
        $request->session()->regenerateToken();

        return Redirect::to('/');
    }
}


### FILE: src/app/Http/Controllers/ReservationController.php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Restaurant;
use App\Models\Reservation;
use App\Models\RestaurantSeatType;
use App\Models\RestaurantTimeSetting;
use Carbon\Carbon;

class ReservationController extends Controller
{
    /**
     * 予約フォーム表示（Viewはまだないので仮置き）
     */
    public function create(Restaurant $restaurant)
    {
        // 店舗に紐づく席タイプを取得してViewに渡す
        $seatTypes = $restaurant->seatTypes;
        return view('reservations.create', compact('restaurant', 'seatTypes'));
    }

    /**
     * 予約実行ロジック
     */
    public function store(Request $request, Restaurant $restaurant)
    {
        // 1. 入力値のバリデーション
        $request->validate([
            'seat_type_id' => 'required|exists:restaurant_seat_types,id',
            'reservation_date' => 'required|date', // 例: 2023-12-01
            'reservation_time' => 'required|date_format:H:i', // 例: 19:00
            'number_of_people' => 'required|integer|min:1',
        ]);

        // 予約開始日時をCarbonインスタンス化
        $startDateTime = Carbon::parse($request->reservation_date . ' ' . $request->reservation_time);
        $dayOfWeek = $startDateTime->dayOfWeek; // 0(日)〜6(土)

        // 2. その時間の「滞在時間ルール」を取得
        // (例: 月曜の19:00を含む設定を探す)
        $timeSetting = RestaurantTimeSetting::where('restaurant_id', $restaurant->id)
            ->where('day_of_week', $dayOfWeek)
            ->where('start_time', '<=', $request->reservation_time)
            ->where('end_time', '>=', $request->reservation_time)
            ->first();

        // 設定が見つからない（営業時間外など）場合はエラー
        if (!$timeSetting) {
            return back()->withErrors(['time' => '指定された時間は予約を受け付けていません。']);
        }

        // 3. 終了時間を計算 (開始 + 設定された滞在時間)
        $endDateTime = $startDateTime->copy()->addMinutes($timeSetting->stay_minutes);

        // 4. 空席チェック（重複チェックの魔法の公式）
        // 指定された席タイプの定員を取得
        $seatType = RestaurantSeatType::find($request->seat_type_id);
        $capacity = $seatType->capacity;

        // 時間が被っている予約をカウント
        $existingReservationsCount = Reservation::where('restaurant_id', $restaurant->id)
            ->where('restaurant_seat_type_id', $seatType->id)
            ->where(function ($query) use ($startDateTime, $endDateTime) {
                // (開始 < 既存終了) AND (終了 > 既存開始)
                $query->where('reserved_at', '<', $endDateTime)
                      ->where('end_at', '>', $startDateTime);
            })
            ->count();

        // 5. 判定 & 保存
        if ($existingReservationsCount >= $capacity) {
            return back()->withErrors(['error' => '申し訳ありません。その時間は満席です。']);
        }

        // 予約作成
        Reservation::create([
            'user_id' => 1, // ★仮：ログイン機能実装後は Auth::id() に変更
            'restaurant_id' => $restaurant->id,
            'restaurant_seat_type_id' => $seatType->id,
            'reserved_at' => $startDateTime,
            'end_at' => $endDateTime, // 計算した終了時間を保存
            'number_of_people' => $request->number_of_people,
        ]);

        return redirect()->route('reservations.create', $restaurant->id)
            ->with('success', '予約が完了しました！');
    }
}

### FILE: src/app/Http/Controllers/RestaurantController.php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Restaurant;
use App\Models\RestaurantImage;
use App\Models\Prefecture;
use App\Models\City;
use App\Models\Genre;
use Illuminate\Support\Facades\Storage;
// ★★★ ↓この1行を必ず追加してください！ ★★★
use Illuminate\Support\Facades\Http; 

class RestaurantController extends Controller
{
    // ...
    /**
     * 店舗一覧表示（検索機能・並び替え機能付き）
     */
    public function index(Request $request)
    {
        // ベースのクエリ
        // ★並び替えに必要なデータ（評価平均、レビュー数、お気に入り数）を事前に計算しておく
        $query = Restaurant::query()
            ->with('city.prefecture')
            ->withAvg('reviews', 'rating')  // reviews_avg_rating が利用可能になる
            ->withCount('reviews')          // reviews_count が利用可能になる
            ->withCount('favorites');       // favorites_count が利用可能になる

        // 1. キーワード検索（Meilisearch利用：既存機能）
        if ($request->filled('keyword')) {
            // Meilisearchで検索し、ヒットしたIDを取得
            $searchResultIds = Restaurant::search($request->keyword)->keys();
            
            // ヒットしたIDの店舗だけに絞り込む
            $query->whereIn('id', $searchResultIds);
        }

        // 2. エリア選択（プルダウン）による絞り込み（既存機能）
        if ($request->filled('prefecture_id')) {
            $query->whereHas('city', function($q) use ($request) {
                $q->where('prefecture_id', $request->prefecture_id);
            });
        }

        // 3. 並び替えロジック（★今回追加した機能）
        $sort = $request->input('sort');
        $lat = $request->input('lat');
        $lng = $request->input('lng');

        switch ($sort) {
            case 'nearest':
                // 現在地から近い順（位置情報がある場合のみ）
                if ($lat && $lng) {
                    // 球面三角法で距離を計算し、distanceという名前で取得して並び替え
                    $query->select('*')
                        ->selectRaw(
                            '(6371 * acos(cos(radians(?)) * cos(radians(latitude)) * cos(radians(longitude) - radians(?)) + sin(radians(?)) * sin(radians(latitude)))) AS distance',
                            [$lat, $lng, $lat]
                        )
                        ->orderBy('distance');
                }
                break;

            case 'rating':
                // 評価が高い順
                $query->orderByDesc('reviews_avg_rating');
                break;

            case 'favorites':
                // お気に入り数が多い順
                $query->orderByDesc('favorites_count');
                break;

            case 'reviews':
                // 口コミ数が多い順
                $query->orderByDesc('reviews_count');
                break;

            default:
                // デフォルトは新着順（既存機能）
                $query->latest();
                break;
        }

        // ページネーション（検索条件を維持するためのappendsを追加）
        // ※データ量が増えると get() だと重くなるため paginate(12) に変更しています
        $restaurants = $query->paginate(12)->appends($request->all());
        
        $prefectures = Prefecture::all();

        return view('restaurants.index', compact('restaurants', 'prefectures'));
    }
/**
     * 店舗詳細画面を表示
     */
    public function show($id)
    {
        // IDに紐づく店舗情報を取得（見つからなければ404エラー）
        // リレーション（レビュー、レビュー画像、レビュー投稿者）もまとめて取得
        $restaurant = \App\Models\Restaurant::with([
            'reviews.user',   // レビューの投稿者
            'reviews.images'  // レビューの画像
            // 'categories',  // ジャンル機能が実装済みならここに追加
        ])->findOrFail($id);

        return view('restaurants.show', compact('restaurant'));
    }
    /**
     * 店舗作成画面の表示
     */
    public function create()
    {
        // 市区町村データも一緒に取得してパフォーマンス向上
        $prefectures = Prefecture::with('cities')->get();
        $genres = Genre::all();

        return view('restaurants.create', compact('prefectures', 'genres'));
    }

    /**
     * 店舗保存処理
     */
   /**
     * 店舗保存処理（OpenStreetMap版）
     */
/**
     * 店舗保存処理（完成版）
     */
    public function store(Request $request)
    {
        // 1. 入力チェック
        $request->validate([
            'name' => 'required|string|max:255',
            'description' => 'required|string',
            'city_id' => 'required|exists:cities,id',
            'address' => 'required|string|max:255',
            'nearest_station' => 'nullable|string|max:255',
            'menu_info' => 'nullable|string',
            'images.*' => 'nullable|image|max:2048', 
        ]);

        // 2. OpenStreetMapから座標を取得
        $latitude = null;
        $longitude = null;

        try {
            // 住所の組み立て
            $city = City::with('prefecture')->find($request->city_id);
            $fullAddress = $city->prefecture->name . $city->name . $request->address;

            // APIリクエスト
            $response = Http::withHeaders([
                // ★成功したUser-Agent設定を採用
                'User-Agent' => 'LaravelApp/1.0 (test-user)' 
            ])->get('https://nominatim.openstreetmap.org/search', [
                'q' => $fullAddress,
                'format' => 'json',
                'limit' => 1,
            ]);

            // データがあれば座標を取り出す
            if ($response->successful() && !empty($response->json())) {
                $data = $response->json()[0];
                $latitude = $data['lat'];
                $longitude = $data['lon'];
            }

        } catch (\Exception $e) {
            // エラー時はログに残して続行
            \Log::error('Geocoding Error: ' . $e->getMessage());
        }

        // 3. データベースへ保存
        $restaurant = Restaurant::create([
            'name' => $request->name,
            'description' => $request->description,
            'city_id' => $request->city_id,
            'address' => $request->address,
            'nearest_station' => $request->nearest_station,
            'menu_info' => $request->menu_info,
            'user_id' => auth()->id(),
            // ★取得した座標を保存（取れなかった場合はnull）
            'latitude' => $latitude,
            'longitude' => $longitude,
        ]);

        // 4. 画像の保存
        if ($request->hasFile('images')) {
            foreach ($request->file('images') as $image) {
                $path = $image->store('restaurant_images', 'public');
                RestaurantImage::create([
                    'restaurant_id' => $restaurant->id,
                    'image_path' => $path,
                ]);
            }
        }

        return redirect()->route('dashboard')->with('success', '店舗を登録しました！');
    }

    
    public function destroy($id)
    {
        $restaurant = Restaurant::findOrFail($id);
        if ($restaurant->user_id !== auth()->id()) {
            abort(403, '権限がありません。');
        }
        $restaurant->delete();
        return to_route('dashboard')->with('success', '店舗を削除しました。');
    }
}

### FILE: src/app/Http/Controllers/ReviewController.php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Review;
use Illuminate\Support\Facades\Auth;

class ReviewController extends Controller
{
    // レビューを保存する
public function store(Request $request, $restaurantId)
    {
        // 1. バリデーション（画像チェックを追加）
        $request->validate([
            'rating' => 'required|integer|min:1|max:5',
            'comment' => 'required|string|max:500',
            'images.*' => 'image|mimes:jpeg,png,jpg,gif|max:2048', // 1枚あたり2MBまで
        ]);

        // 2. レビュー本体を保存
        $review = Review::create([
            'restaurant_id' => $restaurantId,
            'user_id' => Auth::id(),
            'rating' => $request->rating,
            'comment' => $request->comment,
        ]);

        // 3. 画像があれば保存（複数枚対応）
        if ($request->hasFile('images')) {
            foreach ($request->file('images') as $image) {
                // storage/app/public/reviews フォルダに保存
                $path = $image->store('reviews', 'public');
                
                // データベースにパスを保存
                $review->images()->create([
                    'image_path' => $path,
                ]);
            }
        }

        return back();
    }
    // ... storeメソッドなどの続き ...

    /**
     * レビュー削除処理
     */
    public function destroy(Review $review)
    {
        // セキュリティチェック：自分のレビューでなければエラーにする
        if ($review->user_id !== Auth::id()) {
            abort(403, '権限がありません。');
        }

        // 削除実行
        $review->delete();

        return back()->with('success', 'レビューを削除しました。');
    }


}

### FILE: src/app/Http/Middleware/AdminMiddleware.php
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;
use Illuminate\Support\Facades\Auth;

class AdminMiddleware
{
    public function handle(Request $request, Closure $next): Response
    {
        // ログインしていない、または権限が管理者(3)でない場合は弾く
        if (!Auth::check() || Auth::user()->role_id !== 3) {
            // 403 Forbidden（権限なし）を返す、またはトップへリダイレクト
            abort(403, '管理者権限がありません。');
        }

        return $next($request);
    }
}


### FILE: src/app/Http/Middleware/EnsureUserIsOwner.php
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;

class EnsureUserIsOwner
{
    /**
     * Handle an incoming request.
     *
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */
    public function handle(Request $request, Closure $next): Response
    {
        // ログインしていない、または店舗オーナー(role_id=2)でない場合
        if (! $request->user() || ! $request->user()->isStoreOwner()) {
            // トップページへ強制送還
            return redirect('/');
        }

        return $next($request);
    }
}

### FILE: src/app/Http/Middleware/OwnerMiddleware.php
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;
use Illuminate\Support\Facades\Auth;

class OwnerMiddleware
{
    /**
     * Handle an incoming request.
     *
     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next
     */
    public function handle(Request $request, Closure $next): Response
    {
        // ログインしていない、または role_id が 2 (店舗代表者) でない場合は弾く
        // ※必要であれば管理者の role_id 3 も許可に含めてOK (例: ... || Auth::user()->role_id === 3)
        if (!Auth::check() || Auth::user()->role_id !== 2) {
            abort(403, '店舗代表者の権限がありません。');
        }

        return $next($request);
    }
}

### FILE: src/app/Http/Requests/Auth/LoginRequest.php
<?php

namespace App\Http\Requests\Auth;

use Illuminate\Auth\Events\Lockout;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\RateLimiter;
use Illuminate\Support\Str;
use Illuminate\Validation\ValidationException;

class LoginRequest extends FormRequest
{
    /**
     * Determine if the user is authorized to make this request.
     */
    public function authorize(): bool
    {
        return true;
    }

    /**
     * Get the validation rules that apply to the request.
     *
     * @return array<string, \Illuminate\Contracts\Validation\ValidationRule|array<mixed>|string>
     */
    public function rules(): array
    {
        return [
            'email' => ['required', 'string', 'email'],
            'password' => ['required', 'string'],
        ];
    }

    /**
     * Attempt to authenticate the request's credentials.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    public function authenticate(): void
    {
        $this->ensureIsNotRateLimited();

        if (! Auth::attempt($this->only('email', 'password'), $this->boolean('remember'))) {
            RateLimiter::hit($this->throttleKey());

            throw ValidationException::withMessages([
                'email' => trans('auth.failed'),
            ]);
        }

        RateLimiter::clear($this->throttleKey());
    }

    /**
     * Ensure the login request is not rate limited.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    public function ensureIsNotRateLimited(): void
    {
        if (! RateLimiter::tooManyAttempts($this->throttleKey(), 5)) {
            return;
        }

        event(new Lockout($this));

        $seconds = RateLimiter::availableIn($this->throttleKey());

        throw ValidationException::withMessages([
            'email' => trans('auth.throttle', [
                'seconds' => $seconds,
                'minutes' => ceil($seconds / 60),
            ]),
        ]);
    }

    /**
     * Get the rate limiting throttle key for the request.
     */
    public function throttleKey(): string
    {
        return Str::transliterate(Str::lower($this->string('email')).'|'.$this->ip());
    }
}


### FILE: src/app/Http/Requests/ProfileUpdateRequest.php
<?php

namespace App\Http\Requests;

use App\Models\User;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Validation\Rule;

class ProfileUpdateRequest extends FormRequest
{
    /**
     * Get the validation rules that apply to the request.
     *
     * @return array<string, \Illuminate\Contracts\Validation\ValidationRule|array<mixed>|string>
     */
    public function rules(): array
    {
        return [
            'name' => ['required', 'string', 'max:255'],
            'email' => [
                'required',
                'string',
                'lowercase',
                'email',
                'max:255',
                Rule::unique(User::class)->ignore($this->user()->id),
            ],
        ];
    }
}


### FILE: src/app/Models/City.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory; // ★ここを追加
use Illuminate\Database\Eloquent\Model;

class City extends Model
{
    use HasFactory; // ★ここを追加

    // どの都道府県に属しているか
    public function prefecture()
    {
        return $this->belongsTo(Prefecture::class);
    }
}

### FILE: src/app/Models/Favorite.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Favorite extends Model
{
    use HasFactory;

    protected $fillable = ['user_id', 'restaurant_id'];

    public function user()
    {
        return $this->belongsTo(User::class);
    }

    public function restaurant()
    {
        return $this->belongsTo(Restaurant::class);
    }
}

### FILE: src/app/Models/Genre.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Genre extends Model
{
    //
}


### FILE: src/app/Models/MenuItem.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class MenuItem extends Model
{
    //
}


### FILE: src/app/Models/MenuItemImage.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class MenuItemImage extends Model
{
    //
}


### FILE: src/app/Models/Prefecture.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Prefecture extends Model
{
    use HasFactory;

    protected $fillable = ['name'];

    // ★★★ これが足りていなかったためエラーになっていました ★★★
    // 都道府県は複数の市区町村を持つ
    public function cities()
    {
        return $this->hasMany(City::class);
    }
}

### FILE: src/app/Models/Reservation.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Reservation extends Model
{
    use HasFactory;

    protected $fillable = [
        'user_id',
        'restaurant_id',
        'restaurant_seat_type_id', // 追加
        'reserved_at',
        'end_at', // 追加
        'number_of_people',
    ];

    // 日付カラムをCarbonインスタンス（日付操作ライブラリ）として扱う
    protected $casts = [
        'reserved_at' => 'datetime',
        'end_at'      => 'datetime',
    ];

    public function user()
    {
        return $this->belongsTo(User::class);
    }

    public function restaurant()
    {
        return $this->belongsTo(Restaurant::class);
    }

    // リレーション：どの席タイプで予約したか
    public function seatType()
    {
        // 外部キーが 'restaurant_seat_type_id' なので明示的に指定する場合もありますが、
        // Laravelの命名規則通りなら自動判定されます。念のため belongsTo の第2引数は省略可。
        return $this->belongsTo(RestaurantSeatType::class, 'restaurant_seat_type_id');
    }
}

### FILE: src/app/Models/Restaurant.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Laravel\Scout\Searchable;

class Restaurant extends Model
{
    use HasFactory, Searchable;

    protected $fillable = [
        'name',
        'description',
        'menu_info',
        'nearest_station',
        'city_id',
        'address',
        'user_id',
        'latitude',  // ★追加
        'longitude', // ★追加
    ];

    // 店舗の所有者（ユーザー）へのリレーション
    public function user()
    {
        return $this->belongsTo(User::class);
    }

    public function city()
    {
        return $this->belongsTo(City::class);
    }

    public function images()
    {
        return $this->hasMany(RestaurantImage::class);
    }

    public function reviews()
    {
        return $this->hasMany(Review::class);
    }

    public function favorites()
    {
        return $this->hasMany(Favorite::class);
    }

    /**
     * 検索エンジン（Meilisearch）に保存するデータ構造を定義
     */
    public function toSearchableArray()
    {
        // リレーションをロード
        $this->load('city.prefecture');

        // MeCabサービスをフルパスで呼び出し
        $mecab = new \App\Services\MecabService();

        return [
            'id' => $this->id,
            'name' => $this->name,
            'description' => $this->description,
            'address' => $this->address,
            'nearest_station' => $this->nearest_station,
            'menu_info' => $this->menu_info,
            
            // 通常のエリア情報
            'city_name' => $this->city ? $this->city->name : '',
            'prefecture_name' => $this->city && $this->city->prefecture ? $this->city->prefecture->name : '',

            // ★読み仮名（カタカナ）データ
            'name_kana' => $mecab->toKatakana($this->name ?? ''),
            'description_kana' => $mecab->toKatakana($this->description ?? ''),
            'menu_info_kana' => $mecab->toKatakana($this->menu_info ?? ''),
            'city_kana' => $this->city ? $mecab->toKatakana($this->city->name) : '',
        ];
    }
    public function reservations()
    {
        return $this->hasMany(Reservation::class);
    }

    // ★追加: 店舗は複数の「席タイプ」を持つ
    public function seatTypes()
    {
        return $this->hasMany(RestaurantSeatType::class);
    }

    // ★追加: 店舗は複数の「時間設定」を持つ
    public function timeSettings()
    {
        return $this->hasMany(RestaurantTimeSetting::class);
    }

}

### FILE: src/app/Models/RestaurantImage.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class RestaurantImage extends Model
{
    use HasFactory;

    protected $fillable = ['restaurant_id', 'image_path'];

    public function restaurant()
    {
        return $this->belongsTo(Restaurant::class);
    }
}

### FILE: src/app/Models/RestaurantSeatType.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class RestaurantSeatType extends Model
{
    use HasFactory;

    // 保存を許可するカラム
    protected $fillable = [
        'restaurant_id',
        'name',
        'capacity',
    ];

    // リレーション：この席タイプは、ある店舗に属している
    public function restaurant()
    {
        return $this->belongsTo(Restaurant::class);
    }

    // リレーション：この席タイプには、複数の予約が入る
    public function reservations()
    {
        return $this->hasMany(Reservation::class);
    }
}


### FILE: src/app/Models/RestaurantTimeSetting.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class RestaurantTimeSetting extends Model
{
    use HasFactory;

    protected $fillable = [
        'restaurant_id',
        'day_of_week',
        'start_time',
        'end_time',
        'stay_minutes',
    ];

    // リレーション：この設定は、ある店舗に属している
    public function restaurant()
    {
        return $this->belongsTo(Restaurant::class);
    }
}

### FILE: src/app/Models/Review.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Factories\HasFactory;

class Review extends Model
{
    use HasFactory;

    // 書き込みを許可する項目
    protected $fillable = ['restaurant_id', 'user_id', 'rating', 'comment'];

    // レビューを書いたユーザー
    public function user()
    {
        return $this->belongsTo(User::class);
    }

    // ★これを追加！：レビュー対象のお店
    public function restaurant()
    {
        return $this->belongsTo(Restaurant::class);
    }
    // このレビューに紐づく画像たち
    public function images()
    {
        return $this->hasMany(ReviewImage::class);
    }
}

### FILE: src/app/Models/ReviewImage.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class ReviewImage extends Model
{
    protected $fillable = ['review_id', 'image_path'];

    public function review()
    {
        return $this->belongsTo(Review::class);
    }
}

### FILE: src/app/Models/User.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;

class User extends Authenticatable
{
    use HasFactory, Notifiable;

    protected $fillable = [
        'name',
        'email',
        'password',
        'role_id',
    ];

    protected $hidden = [
        'password',
        'remember_token',
    ];

    protected $casts = [
        'email_verified_at' => 'datetime',
        'password' => 'hashed',
    ];

    // ユーザーがお気に入り登録したデータ
    public function favorites()
    {
        return $this->hasMany(Favorite::class);
    }

    // ユーザーが投稿したレビューデータ
    public function reviews()
    {
        return $this->hasMany(Review::class);
    }

    // ユーザー自身が所有（作成）した店舗データ
    public function restaurants()
    {
        return $this->hasMany(Restaurant::class);
    }

    // 店舗オーナーかどうか判定
    public function isStoreOwner()
    {
        return $this->role_id === 2;
    }
}

### FILE: src/app/Providers/AppServiceProvider.php
<?php

namespace App\Providers;

use Illuminate\Support\ServiceProvider;
use Illuminate\Support\Facades\View; // ★追加
use App\Models\Prefecture; // ★追加

class AppServiceProvider extends ServiceProvider
{
    /**
     * Register any application services.
     */
    public function register(): void
    {
        //
    }

    /**
     * Bootstrap any application services.
     */
    public function boot(): void
    {
        // ★追加：ヘッダー（components.site-header）が表示される時は、
        // 常に $headerPrefectures という変数で都道府県データを渡す
        View::composer('components.site-header', function ($view) {
            $view->with('headerPrefectures', Prefecture::all());
        });
    }
}

### FILE: src/app/Services/MecabService.php
<?php

namespace App\Services;

class MecabService
{
    /**
     * テキストをカタカナ（読み仮名）に変換する
     *
     * @param string $text 変換したい日本語テキスト
     * @return string カタカナに変換されたテキスト
     */
    public function toKatakana(string $text): string
    {
        // 空文字ならそのまま返す
        if (empty($text)) {
            return '';
        }

        // コマンドライン用の安全な文字列にエスケープ（セキュリティ対策）
        $escapedText = escapeshellarg($text);

        // MeCabコマンドを実行
        // echo "テキスト" | mecab -O yomi
        $command = "echo {$escapedText} | mecab -O yomi";
        
        // コマンドを実行して結果を受け取る
        $output = shell_exec($command);

        // 余計な改行や空白を削除して返す
        return trim($output ?? '');
    }
}

### FILE: src/app/View/Components/AppLayout.php
<?php

namespace App\View\Components;

use Illuminate\View\Component;
use Illuminate\View\View;

class AppLayout extends Component
{
    /**
     * Get the view / contents that represents the component.
     */
    public function render(): View
    {
        return view('layouts.app');
    }
}


### FILE: src/app/View/Components/GuestLayout.php
<?php

namespace App\View\Components;

use Illuminate\View\Component;
use Illuminate\View\View;

class GuestLayout extends Component
{
    /**
     * Get the view / contents that represents the component.
     */
    public function render(): View
    {
        return view('layouts.guest');
    }
}


### FILE: src/bootstrap/app.php
<?php

use Illuminate\Foundation\Application;
use Illuminate\Foundation\Configuration\Exceptions;
use Illuminate\Foundation\Configuration\Middleware;
// ★追加
use App\Http\Middleware\AdminMiddleware;

return Application::configure(basePath: dirname(__DIR__))
    ->withRouting(
        web: __DIR__.'/../routes/web.php',
        commands: __DIR__.'/../routes/console.php',
        health: '/up',
    )
    ->withMiddleware(function (Middleware $middleware) {
        // ★ここに追加： 'admin' という名前で使えるようにする
        $middleware->alias([
            'admin' => AdminMiddleware::class,
            'owner' => \App\Http\Middleware\OwnerMiddleware::class, // (もし以前作っていれば)
        ]);
    })
    ->withExceptions(function (Exceptions $exceptions) {
        //
    })->create();

### FILE: src/bootstrap/providers.php
<?php

return [
    App\Providers\AppServiceProvider::class,
];


### FILE: src/config/app.php
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Application Name
    |--------------------------------------------------------------------------
    |
    | This value is the name of your application, which will be used when the
    | framework needs to place the application's name in a notification or
    | other UI elements where an application name needs to be displayed.
    |
    */

    'name' => env('APP_NAME', 'Laravel'),

    /*
    |--------------------------------------------------------------------------
    | Application Environment
    |--------------------------------------------------------------------------
    |
    | This value determines the "environment" your application is currently
    | running in. This may determine how you prefer to configure various
    | services the application utilizes. Set this in your ".env" file.
    |
    */

    'env' => env('APP_ENV', 'production'),

    /*
    |--------------------------------------------------------------------------
    | Application Debug Mode
    |--------------------------------------------------------------------------
    |
    | When your application is in debug mode, detailed error messages with
    | stack traces will be shown on every error that occurs within your
    | application. If disabled, a simple generic error page is shown.
    |
    */

    'debug' => (bool) env('APP_DEBUG', false),

    /*
    |--------------------------------------------------------------------------
    | Application URL
    |--------------------------------------------------------------------------
    |
    | This URL is used by the console to properly generate URLs when using
    | the Artisan command line tool. You should set this to the root of
    | the application so that it's available within Artisan commands.
    |
    */

    'url' => env('APP_URL', 'http://localhost'),

    /*
    |--------------------------------------------------------------------------
    | Application Timezone
    |--------------------------------------------------------------------------
    |
    | Here you may specify the default timezone for your application, which
    | will be used by the PHP date and date-time functions. The timezone
    | is set to "UTC" by default as it is suitable for most use cases.
    |
    */

    'timezone' => 'UTC',

    /*
    |--------------------------------------------------------------------------
    | Application Locale Configuration
    |--------------------------------------------------------------------------
    |
    | The application locale determines the default locale that will be used
    | by Laravel's translation / localization methods. This option can be
    | set to any locale for which you plan to have translation strings.
    |
    */

    'locale' => env('APP_LOCALE', 'en'),

    'fallback_locale' => env('APP_FALLBACK_LOCALE', 'en'),

    'faker_locale' => env('APP_FAKER_LOCALE', 'en_US'),

    /*
    |--------------------------------------------------------------------------
    | Encryption Key
    |--------------------------------------------------------------------------
    |
    | This key is utilized by Laravel's encryption services and should be set
    | to a random, 32 character string to ensure that all encrypted values
    | are secure. You should do this prior to deploying the application.
    |
    */

    'cipher' => 'AES-256-CBC',

    'key' => env('APP_KEY'),

    'previous_keys' => [
        ...array_filter(
            explode(',', (string) env('APP_PREVIOUS_KEYS', ''))
        ),
    ],

    /*
    |--------------------------------------------------------------------------
    | Maintenance Mode Driver
    |--------------------------------------------------------------------------
    |
    | These configuration options determine the driver used to determine and
    | manage Laravel's "maintenance mode" status. The "cache" driver will
    | allow maintenance mode to be controlled across multiple machines.
    |
    | Supported drivers: "file", "cache"
    |
    */

    'maintenance' => [
        'driver' => env('APP_MAINTENANCE_DRIVER', 'file'),
        'store' => env('APP_MAINTENANCE_STORE', 'database'),
    ],

];


### FILE: src/config/auth.php
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Authentication Defaults
    |--------------------------------------------------------------------------
    |
    | This option defines the default authentication "guard" and password
    | reset "broker" for your application. You may change these values
    | as required, but they're a perfect start for most applications.
    |
    */

    'defaults' => [
        'guard' => env('AUTH_GUARD', 'web'),
        'passwords' => env('AUTH_PASSWORD_BROKER', 'users'),
    ],

    /*
    |--------------------------------------------------------------------------
    | Authentication Guards
    |--------------------------------------------------------------------------
    |
    | Next, you may define every authentication guard for your application.
    | Of course, a great default configuration has been defined for you
    | which utilizes session storage plus the Eloquent user provider.
    |
    | All authentication guards have a user provider, which defines how the
    | users are actually retrieved out of your database or other storage
    | system used by the application. Typically, Eloquent is utilized.
    |
    | Supported: "session"
    |
    */

    'guards' => [
        'web' => [
            'driver' => 'session',
            'provider' => 'users',
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | User Providers
    |--------------------------------------------------------------------------
    |
    | All authentication guards have a user provider, which defines how the
    | users are actually retrieved out of your database or other storage
    | system used by the application. Typically, Eloquent is utilized.
    |
    | If you have multiple user tables or models you may configure multiple
    | providers to represent the model / table. These providers may then
    | be assigned to any extra authentication guards you have defined.
    |
    | Supported: "database", "eloquent"
    |
    */

    'providers' => [
        'users' => [
            'driver' => 'eloquent',
            'model' => env('AUTH_MODEL', App\Models\User::class),
        ],

        // 'users' => [
        //     'driver' => 'database',
        //     'table' => 'users',
        // ],
    ],

    /*
    |--------------------------------------------------------------------------
    | Resetting Passwords
    |--------------------------------------------------------------------------
    |
    | These configuration options specify the behavior of Laravel's password
    | reset functionality, including the table utilized for token storage
    | and the user provider that is invoked to actually retrieve users.
    |
    | The expiry time is the number of minutes that each reset token will be
    | considered valid. This security feature keeps tokens short-lived so
    | they have less time to be guessed. You may change this as needed.
    |
    | The throttle setting is the number of seconds a user must wait before
    | generating more password reset tokens. This prevents the user from
    | quickly generating a very large amount of password reset tokens.
    |
    */

    'passwords' => [
        'users' => [
            'provider' => 'users',
            'table' => env('AUTH_PASSWORD_RESET_TOKEN_TABLE', 'password_reset_tokens'),
            'expire' => 60,
            'throttle' => 60,
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | Password Confirmation Timeout
    |--------------------------------------------------------------------------
    |
    | Here you may define the number of seconds before a password confirmation
    | window expires and users are asked to re-enter their password via the
    | confirmation screen. By default, the timeout lasts for three hours.
    |
    */

    'password_timeout' => env('AUTH_PASSWORD_TIMEOUT', 10800),

];


### FILE: src/config/cache.php
<?php

use Illuminate\Support\Str;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Cache Store
    |--------------------------------------------------------------------------
    |
    | This option controls the default cache store that will be used by the
    | framework. This connection is utilized if another isn't explicitly
    | specified when running a cache operation inside the application.
    |
    */

    'default' => env('CACHE_STORE', 'database'),

    /*
    |--------------------------------------------------------------------------
    | Cache Stores
    |--------------------------------------------------------------------------
    |
    | Here you may define all of the cache "stores" for your application as
    | well as their drivers. You may even define multiple stores for the
    | same cache driver to group types of items stored in your caches.
    |
    | Supported drivers: "array", "database", "file", "memcached",
    |                    "redis", "dynamodb", "octane",
    |                    "failover", "null"
    |
    */

    'stores' => [

        'array' => [
            'driver' => 'array',
            'serialize' => false,
        ],

        'database' => [
            'driver' => 'database',
            'connection' => env('DB_CACHE_CONNECTION'),
            'table' => env('DB_CACHE_TABLE', 'cache'),
            'lock_connection' => env('DB_CACHE_LOCK_CONNECTION'),
            'lock_table' => env('DB_CACHE_LOCK_TABLE'),
        ],

        'file' => [
            'driver' => 'file',
            'path' => storage_path('framework/cache/data'),
            'lock_path' => storage_path('framework/cache/data'),
        ],

        'memcached' => [
            'driver' => 'memcached',
            'persistent_id' => env('MEMCACHED_PERSISTENT_ID'),
            'sasl' => [
                env('MEMCACHED_USERNAME'),
                env('MEMCACHED_PASSWORD'),
            ],
            'options' => [
                // Memcached::OPT_CONNECT_TIMEOUT => 2000,
            ],
            'servers' => [
                [
                    'host' => env('MEMCACHED_HOST', '127.0.0.1'),
                    'port' => env('MEMCACHED_PORT', 11211),
                    'weight' => 100,
                ],
            ],
        ],

        'redis' => [
            'driver' => 'redis',
            'connection' => env('REDIS_CACHE_CONNECTION', 'cache'),
            'lock_connection' => env('REDIS_CACHE_LOCK_CONNECTION', 'default'),
        ],

        'dynamodb' => [
            'driver' => 'dynamodb',
            'key' => env('AWS_ACCESS_KEY_ID'),
            'secret' => env('AWS_SECRET_ACCESS_KEY'),
            'region' => env('AWS_DEFAULT_REGION', 'us-east-1'),
            'table' => env('DYNAMODB_CACHE_TABLE', 'cache'),
            'endpoint' => env('DYNAMODB_ENDPOINT'),
        ],

        'octane' => [
            'driver' => 'octane',
        ],

        'failover' => [
            'driver' => 'failover',
            'stores' => [
                'database',
                'array',
            ],
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Cache Key Prefix
    |--------------------------------------------------------------------------
    |
    | When utilizing the APC, database, memcached, Redis, and DynamoDB cache
    | stores, there might be other applications using the same cache. For
    | that reason, you may prefix every cache key to avoid collisions.
    |
    */

    'prefix' => env('CACHE_PREFIX', Str::slug((string) env('APP_NAME', 'laravel')).'-cache-'),

];


### FILE: src/config/database.php
<?php

use Illuminate\Support\Str;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Database Connection Name
    |--------------------------------------------------------------------------
    |
    | Here you may specify which of the database connections below you wish
    | to use as your default connection for database operations. This is
    | the connection which will be utilized unless another connection
    | is explicitly specified when you execute a query / statement.
    |
    */

    'default' => env('DB_CONNECTION', 'sqlite'),

    /*
    |--------------------------------------------------------------------------
    | Database Connections
    |--------------------------------------------------------------------------
    |
    | Below are all of the database connections defined for your application.
    | An example configuration is provided for each database system which
    | is supported by Laravel. You're free to add / remove connections.
    |
    */

    'connections' => [

        'sqlite' => [
            'driver' => 'sqlite',
            'url' => env('DB_URL'),
            'database' => env('DB_DATABASE', database_path('database.sqlite')),
            'prefix' => '',
            'foreign_key_constraints' => env('DB_FOREIGN_KEYS', true),
            'busy_timeout' => null,
            'journal_mode' => null,
            'synchronous' => null,
            'transaction_mode' => 'DEFERRED',
        ],

        'mysql' => [
            'driver' => 'mysql',
            'url' => env('DB_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '3306'),
            'database' => env('DB_DATABASE', 'laravel'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
            'unix_socket' => env('DB_SOCKET', ''),
            'charset' => env('DB_CHARSET', 'utf8mb4'),
            'collation' => env('DB_COLLATION', 'utf8mb4_unicode_ci'),
            'prefix' => '',
            'prefix_indexes' => true,
            'strict' => true,
            'engine' => null,
            'options' => extension_loaded('pdo_mysql') ? array_filter([
                (PHP_VERSION_ID >= 80500 ? \Pdo\Mysql::ATTR_SSL_CA : \PDO::MYSQL_ATTR_SSL_CA) => env('MYSQL_ATTR_SSL_CA'),
            ]) : [],
        ],

        'mariadb' => [
            'driver' => 'mariadb',
            'url' => env('DB_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '3306'),
            'database' => env('DB_DATABASE', 'laravel'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
            'unix_socket' => env('DB_SOCKET', ''),
            'charset' => env('DB_CHARSET', 'utf8mb4'),
            'collation' => env('DB_COLLATION', 'utf8mb4_unicode_ci'),
            'prefix' => '',
            'prefix_indexes' => true,
            'strict' => true,
            'engine' => null,
            'options' => extension_loaded('pdo_mysql') ? array_filter([
                (PHP_VERSION_ID >= 80500 ? \Pdo\Mysql::ATTR_SSL_CA : \PDO::MYSQL_ATTR_SSL_CA) => env('MYSQL_ATTR_SSL_CA'),
            ]) : [],
        ],

        'pgsql' => [
            'driver' => 'pgsql',
            'url' => env('DB_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '5432'),
            'database' => env('DB_DATABASE', 'laravel'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
            'charset' => env('DB_CHARSET', 'utf8'),
            'prefix' => '',
            'prefix_indexes' => true,
            'search_path' => 'public',
            'sslmode' => env('DB_SSLMODE', 'prefer'),
        ],

        'sqlsrv' => [
            'driver' => 'sqlsrv',
            'url' => env('DB_URL'),
            'host' => env('DB_HOST', 'localhost'),
            'port' => env('DB_PORT', '1433'),
            'database' => env('DB_DATABASE', 'laravel'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
            'charset' => env('DB_CHARSET', 'utf8'),
            'prefix' => '',
            'prefix_indexes' => true,
            // 'encrypt' => env('DB_ENCRYPT', 'yes'),
            // 'trust_server_certificate' => env('DB_TRUST_SERVER_CERTIFICATE', 'false'),
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Migration Repository Table
    |--------------------------------------------------------------------------
    |
    | This table keeps track of all the migrations that have already run for
    | your application. Using this information, we can determine which of
    | the migrations on disk haven't actually been run on the database.
    |
    */

    'migrations' => [
        'table' => 'migrations',
        'update_date_on_publish' => true,
    ],

    /*
    |--------------------------------------------------------------------------
    | Redis Databases
    |--------------------------------------------------------------------------
    |
    | Redis is an open source, fast, and advanced key-value store that also
    | provides a richer body of commands than a typical key-value system
    | such as Memcached. You may define your connection settings here.
    |
    */

    'redis' => [

        'client' => env('REDIS_CLIENT', 'phpredis'),

        'options' => [
            'cluster' => env('REDIS_CLUSTER', 'redis'),
            'prefix' => env('REDIS_PREFIX', Str::slug((string) env('APP_NAME', 'laravel')).'-database-'),
            'persistent' => env('REDIS_PERSISTENT', false),
        ],

        'default' => [
            'url' => env('REDIS_URL'),
            'host' => env('REDIS_HOST', '127.0.0.1'),
            'username' => env('REDIS_USERNAME'),
            'password' => env('REDIS_PASSWORD'),
            'port' => env('REDIS_PORT', '6379'),
            'database' => env('REDIS_DB', '0'),
            'max_retries' => env('REDIS_MAX_RETRIES', 3),
            'backoff_algorithm' => env('REDIS_BACKOFF_ALGORITHM', 'decorrelated_jitter'),
            'backoff_base' => env('REDIS_BACKOFF_BASE', 100),
            'backoff_cap' => env('REDIS_BACKOFF_CAP', 1000),
        ],

        'cache' => [
            'url' => env('REDIS_URL'),
            'host' => env('REDIS_HOST', '127.0.0.1'),
            'username' => env('REDIS_USERNAME'),
            'password' => env('REDIS_PASSWORD'),
            'port' => env('REDIS_PORT', '6379'),
            'database' => env('REDIS_CACHE_DB', '1'),
            'max_retries' => env('REDIS_MAX_RETRIES', 3),
            'backoff_algorithm' => env('REDIS_BACKOFF_ALGORITHM', 'decorrelated_jitter'),
            'backoff_base' => env('REDIS_BACKOFF_BASE', 100),
            'backoff_cap' => env('REDIS_BACKOFF_CAP', 1000),
        ],

    ],

];


### FILE: src/config/filesystems.php
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Filesystem Disk
    |--------------------------------------------------------------------------
    |
    | Here you may specify the default filesystem disk that should be used
    | by the framework. The "local" disk, as well as a variety of cloud
    | based disks are available to your application for file storage.
    |
    */

    'default' => env('FILESYSTEM_DISK', 'local'),

    /*
    |--------------------------------------------------------------------------
    | Filesystem Disks
    |--------------------------------------------------------------------------
    |
    | Below you may configure as many filesystem disks as necessary, and you
    | may even configure multiple disks for the same driver. Examples for
    | most supported storage drivers are configured here for reference.
    |
    | Supported drivers: "local", "ftp", "sftp", "s3"
    |
    */

    'disks' => [

        'local' => [
            'driver' => 'local',
            'root' => storage_path('app/private'),
            'serve' => true,
            'throw' => false,
            'report' => false,
        ],

        'public' => [
            'driver' => 'local',
            'root' => storage_path('app/public'),
            'url' => rtrim(env('APP_URL', 'http://localhost'), '/').'/storage',
            'visibility' => 'public',
            'throw' => false,
            'report' => false,
        ],

        's3' => [
            'driver' => 's3',
            'key' => env('AWS_ACCESS_KEY_ID'),
            'secret' => env('AWS_SECRET_ACCESS_KEY'),
            'region' => env('AWS_DEFAULT_REGION'),
            'bucket' => env('AWS_BUCKET'),
            'url' => env('AWS_URL'),
            'endpoint' => env('AWS_ENDPOINT'),
            'use_path_style_endpoint' => env('AWS_USE_PATH_STYLE_ENDPOINT', false),
            'throw' => false,
            'report' => false,
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Symbolic Links
    |--------------------------------------------------------------------------
    |
    | Here you may configure the symbolic links that will be created when the
    | `storage:link` Artisan command is executed. The array keys should be
    | the locations of the links and the values should be their targets.
    |
    */

    'links' => [
        public_path('storage') => storage_path('app/public'),
    ],

];


### FILE: src/config/logging.php
<?php

use Monolog\Handler\NullHandler;
use Monolog\Handler\StreamHandler;
use Monolog\Handler\SyslogUdpHandler;
use Monolog\Processor\PsrLogMessageProcessor;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Log Channel
    |--------------------------------------------------------------------------
    |
    | This option defines the default log channel that is utilized to write
    | messages to your logs. The value provided here should match one of
    | the channels present in the list of "channels" configured below.
    |
    */

    'default' => env('LOG_CHANNEL', 'stack'),

    /*
    |--------------------------------------------------------------------------
    | Deprecations Log Channel
    |--------------------------------------------------------------------------
    |
    | This option controls the log channel that should be used to log warnings
    | regarding deprecated PHP and library features. This allows you to get
    | your application ready for upcoming major versions of dependencies.
    |
    */

    'deprecations' => [
        'channel' => env('LOG_DEPRECATIONS_CHANNEL', 'null'),
        'trace' => env('LOG_DEPRECATIONS_TRACE', false),
    ],

    /*
    |--------------------------------------------------------------------------
    | Log Channels
    |--------------------------------------------------------------------------
    |
    | Here you may configure the log channels for your application. Laravel
    | utilizes the Monolog PHP logging library, which includes a variety
    | of powerful log handlers and formatters that you're free to use.
    |
    | Available drivers: "single", "daily", "slack", "syslog",
    |                    "errorlog", "monolog", "custom", "stack"
    |
    */

    'channels' => [

        'stack' => [
            'driver' => 'stack',
            'channels' => explode(',', (string) env('LOG_STACK', 'single')),
            'ignore_exceptions' => false,
        ],

        'single' => [
            'driver' => 'single',
            'path' => storage_path('logs/laravel.log'),
            'level' => env('LOG_LEVEL', 'debug'),
            'replace_placeholders' => true,
        ],

        'daily' => [
            'driver' => 'daily',
            'path' => storage_path('logs/laravel.log'),
            'level' => env('LOG_LEVEL', 'debug'),
            'days' => env('LOG_DAILY_DAYS', 14),
            'replace_placeholders' => true,
        ],

        'slack' => [
            'driver' => 'slack',
            'url' => env('LOG_SLACK_WEBHOOK_URL'),
            'username' => env('LOG_SLACK_USERNAME', 'Laravel Log'),
            'emoji' => env('LOG_SLACK_EMOJI', ':boom:'),
            'level' => env('LOG_LEVEL', 'critical'),
            'replace_placeholders' => true,
        ],

        'papertrail' => [
            'driver' => 'monolog',
            'level' => env('LOG_LEVEL', 'debug'),
            'handler' => env('LOG_PAPERTRAIL_HANDLER', SyslogUdpHandler::class),
            'handler_with' => [
                'host' => env('PAPERTRAIL_URL'),
                'port' => env('PAPERTRAIL_PORT'),
                'connectionString' => 'tls://'.env('PAPERTRAIL_URL').':'.env('PAPERTRAIL_PORT'),
            ],
            'processors' => [PsrLogMessageProcessor::class],
        ],

        'stderr' => [
            'driver' => 'monolog',
            'level' => env('LOG_LEVEL', 'debug'),
            'handler' => StreamHandler::class,
            'handler_with' => [
                'stream' => 'php://stderr',
            ],
            'formatter' => env('LOG_STDERR_FORMATTER'),
            'processors' => [PsrLogMessageProcessor::class],
        ],

        'syslog' => [
            'driver' => 'syslog',
            'level' => env('LOG_LEVEL', 'debug'),
            'facility' => env('LOG_SYSLOG_FACILITY', LOG_USER),
            'replace_placeholders' => true,
        ],

        'errorlog' => [
            'driver' => 'errorlog',
            'level' => env('LOG_LEVEL', 'debug'),
            'replace_placeholders' => true,
        ],

        'null' => [
            'driver' => 'monolog',
            'handler' => NullHandler::class,
        ],

        'emergency' => [
            'path' => storage_path('logs/laravel.log'),
        ],

    ],

];


### FILE: src/config/mail.php
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Mailer
    |--------------------------------------------------------------------------
    |
    | This option controls the default mailer that is used to send all email
    | messages unless another mailer is explicitly specified when sending
    | the message. All additional mailers can be configured within the
    | "mailers" array. Examples of each type of mailer are provided.
    |
    */

    'default' => env('MAIL_MAILER', 'log'),

    /*
    |--------------------------------------------------------------------------
    | Mailer Configurations
    |--------------------------------------------------------------------------
    |
    | Here you may configure all of the mailers used by your application plus
    | their respective settings. Several examples have been configured for
    | you and you are free to add your own as your application requires.
    |
    | Laravel supports a variety of mail "transport" drivers that can be used
    | when delivering an email. You may specify which one you're using for
    | your mailers below. You may also add additional mailers if needed.
    |
    | Supported: "smtp", "sendmail", "mailgun", "ses", "ses-v2",
    |            "postmark", "resend", "log", "array",
    |            "failover", "roundrobin"
    |
    */

    'mailers' => [

        'smtp' => [
            'transport' => 'smtp',
            'scheme' => env('MAIL_SCHEME'),
            'url' => env('MAIL_URL'),
            'host' => env('MAIL_HOST', '127.0.0.1'),
            'port' => env('MAIL_PORT', 2525),
            'username' => env('MAIL_USERNAME'),
            'password' => env('MAIL_PASSWORD'),
            'timeout' => null,
            'local_domain' => env('MAIL_EHLO_DOMAIN', parse_url((string) env('APP_URL', 'http://localhost'), PHP_URL_HOST)),
        ],

        'ses' => [
            'transport' => 'ses',
        ],

        'postmark' => [
            'transport' => 'postmark',
            // 'message_stream_id' => env('POSTMARK_MESSAGE_STREAM_ID'),
            // 'client' => [
            //     'timeout' => 5,
            // ],
        ],

        'resend' => [
            'transport' => 'resend',
        ],

        'sendmail' => [
            'transport' => 'sendmail',
            'path' => env('MAIL_SENDMAIL_PATH', '/usr/sbin/sendmail -bs -i'),
        ],

        'log' => [
            'transport' => 'log',
            'channel' => env('MAIL_LOG_CHANNEL'),
        ],

        'array' => [
            'transport' => 'array',
        ],

        'failover' => [
            'transport' => 'failover',
            'mailers' => [
                'smtp',
                'log',
            ],
            'retry_after' => 60,
        ],

        'roundrobin' => [
            'transport' => 'roundrobin',
            'mailers' => [
                'ses',
                'postmark',
            ],
            'retry_after' => 60,
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Global "From" Address
    |--------------------------------------------------------------------------
    |
    | You may wish for all emails sent by your application to be sent from
    | the same address. Here you may specify a name and address that is
    | used globally for all emails that are sent by your application.
    |
    */

    'from' => [
        'address' => env('MAIL_FROM_ADDRESS', 'hello@example.com'),
        'name' => env('MAIL_FROM_NAME', 'Example'),
    ],

];


### FILE: src/config/queue.php
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Queue Connection Name
    |--------------------------------------------------------------------------
    |
    | Laravel's queue supports a variety of backends via a single, unified
    | API, giving you convenient access to each backend using identical
    | syntax for each. The default queue connection is defined below.
    |
    */

    'default' => env('QUEUE_CONNECTION', 'database'),

    /*
    |--------------------------------------------------------------------------
    | Queue Connections
    |--------------------------------------------------------------------------
    |
    | Here you may configure the connection options for every queue backend
    | used by your application. An example configuration is provided for
    | each backend supported by Laravel. You're also free to add more.
    |
    | Drivers: "sync", "database", "beanstalkd", "sqs", "redis",
    |          "deferred", "background", "failover", "null"
    |
    */

    'connections' => [

        'sync' => [
            'driver' => 'sync',
        ],

        'database' => [
            'driver' => 'database',
            'connection' => env('DB_QUEUE_CONNECTION'),
            'table' => env('DB_QUEUE_TABLE', 'jobs'),
            'queue' => env('DB_QUEUE', 'default'),
            'retry_after' => (int) env('DB_QUEUE_RETRY_AFTER', 90),
            'after_commit' => false,
        ],

        'beanstalkd' => [
            'driver' => 'beanstalkd',
            'host' => env('BEANSTALKD_QUEUE_HOST', 'localhost'),
            'queue' => env('BEANSTALKD_QUEUE', 'default'),
            'retry_after' => (int) env('BEANSTALKD_QUEUE_RETRY_AFTER', 90),
            'block_for' => 0,
            'after_commit' => false,
        ],

        'sqs' => [
            'driver' => 'sqs',
            'key' => env('AWS_ACCESS_KEY_ID'),
            'secret' => env('AWS_SECRET_ACCESS_KEY'),
            'prefix' => env('SQS_PREFIX', 'https://sqs.us-east-1.amazonaws.com/your-account-id'),
            'queue' => env('SQS_QUEUE', 'default'),
            'suffix' => env('SQS_SUFFIX'),
            'region' => env('AWS_DEFAULT_REGION', 'us-east-1'),
            'after_commit' => false,
        ],

        'redis' => [
            'driver' => 'redis',
            'connection' => env('REDIS_QUEUE_CONNECTION', 'default'),
            'queue' => env('REDIS_QUEUE', 'default'),
            'retry_after' => (int) env('REDIS_QUEUE_RETRY_AFTER', 90),
            'block_for' => null,
            'after_commit' => false,
        ],

        'deferred' => [
            'driver' => 'deferred',
        ],

        'background' => [
            'driver' => 'background',
        ],

        'failover' => [
            'driver' => 'failover',
            'connections' => [
                'database',
                'deferred',
            ],
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Job Batching
    |--------------------------------------------------------------------------
    |
    | The following options configure the database and table that store job
    | batching information. These options can be updated to any database
    | connection and table which has been defined by your application.
    |
    */

    'batching' => [
        'database' => env('DB_CONNECTION', 'sqlite'),
        'table' => 'job_batches',
    ],

    /*
    |--------------------------------------------------------------------------
    | Failed Queue Jobs
    |--------------------------------------------------------------------------
    |
    | These options configure the behavior of failed queue job logging so you
    | can control how and where failed jobs are stored. Laravel ships with
    | support for storing failed jobs in a simple file or in a database.
    |
    | Supported drivers: "database-uuids", "dynamodb", "file", "null"
    |
    */

    'failed' => [
        'driver' => env('QUEUE_FAILED_DRIVER', 'database-uuids'),
        'database' => env('DB_CONNECTION', 'sqlite'),
        'table' => 'failed_jobs',
    ],

];


### FILE: src/config/services.php
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Third Party Services
    |--------------------------------------------------------------------------
    |
    | This file is for storing the credentials for third party services such
    | as Mailgun, Postmark, AWS and more. This file provides the de facto
    | location for this type of information, allowing packages to have
    | a conventional file to locate the various service credentials.
    |
    */

    'postmark' => [
        'key' => env('POSTMARK_API_KEY'),
    ],

    'resend' => [
        'key' => env('RESEND_API_KEY'),
    ],

    'ses' => [
        'key' => env('AWS_ACCESS_KEY_ID'),
        'secret' => env('AWS_SECRET_ACCESS_KEY'),
        'region' => env('AWS_DEFAULT_REGION', 'us-east-1'),
    ],

    'slack' => [
        'notifications' => [
            'bot_user_oauth_token' => env('SLACK_BOT_USER_OAUTH_TOKEN'),
            'channel' => env('SLACK_BOT_USER_DEFAULT_CHANNEL'),
        ],
    ],

];


### FILE: src/config/session.php
<?php

use Illuminate\Support\Str;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Session Driver
    |--------------------------------------------------------------------------
    |
    | This option determines the default session driver that is utilized for
    | incoming requests. Laravel supports a variety of storage options to
    | persist session data. Database storage is a great default choice.
    |
    | Supported: "file", "cookie", "database", "memcached",
    |            "redis", "dynamodb", "array"
    |
    */

    'driver' => env('SESSION_DRIVER', 'database'),

    /*
    |--------------------------------------------------------------------------
    | Session Lifetime
    |--------------------------------------------------------------------------
    |
    | Here you may specify the number of minutes that you wish the session
    | to be allowed to remain idle before it expires. If you want them
    | to expire immediately when the browser is closed then you may
    | indicate that via the expire_on_close configuration option.
    |
    */

    'lifetime' => (int) env('SESSION_LIFETIME', 120),

    'expire_on_close' => env('SESSION_EXPIRE_ON_CLOSE', false),

    /*
    |--------------------------------------------------------------------------
    | Session Encryption
    |--------------------------------------------------------------------------
    |
    | This option allows you to easily specify that all of your session data
    | should be encrypted before it's stored. All encryption is performed
    | automatically by Laravel and you may use the session like normal.
    |
    */

    'encrypt' => env('SESSION_ENCRYPT', false),

    /*
    |--------------------------------------------------------------------------
    | Session File Location
    |--------------------------------------------------------------------------
    |
    | When utilizing the "file" session driver, the session files are placed
    | on disk. The default storage location is defined here; however, you
    | are free to provide another location where they should be stored.
    |
    */

    'files' => storage_path('framework/sessions'),

    /*
    |--------------------------------------------------------------------------
    | Session Database Connection
    |--------------------------------------------------------------------------
    |
    | When using the "database" or "redis" session drivers, you may specify a
    | connection that should be used to manage these sessions. This should
    | correspond to a connection in your database configuration options.
    |
    */

    'connection' => env('SESSION_CONNECTION'),

    /*
    |--------------------------------------------------------------------------
    | Session Database Table
    |--------------------------------------------------------------------------
    |
    | When using the "database" session driver, you may specify the table to
    | be used to store sessions. Of course, a sensible default is defined
    | for you; however, you're welcome to change this to another table.
    |
    */

    'table' => env('SESSION_TABLE', 'sessions'),

    /*
    |--------------------------------------------------------------------------
    | Session Cache Store
    |--------------------------------------------------------------------------
    |
    | When using one of the framework's cache driven session backends, you may
    | define the cache store which should be used to store the session data
    | between requests. This must match one of your defined cache stores.
    |
    | Affects: "dynamodb", "memcached", "redis"
    |
    */

    'store' => env('SESSION_STORE'),

    /*
    |--------------------------------------------------------------------------
    | Session Sweeping Lottery
    |--------------------------------------------------------------------------
    |
    | Some session drivers must manually sweep their storage location to get
    | rid of old sessions from storage. Here are the chances that it will
    | happen on a given request. By default, the odds are 2 out of 100.
    |
    */

    'lottery' => [2, 100],

    /*
    |--------------------------------------------------------------------------
    | Session Cookie Name
    |--------------------------------------------------------------------------
    |
    | Here you may change the name of the session cookie that is created by
    | the framework. Typically, you should not need to change this value
    | since doing so does not grant a meaningful security improvement.
    |
    */

    'cookie' => env(
        'SESSION_COOKIE',
        Str::slug((string) env('APP_NAME', 'laravel')).'-session'
    ),

    /*
    |--------------------------------------------------------------------------
    | Session Cookie Path
    |--------------------------------------------------------------------------
    |
    | The session cookie path determines the path for which the cookie will
    | be regarded as available. Typically, this will be the root path of
    | your application, but you're free to change this when necessary.
    |
    */

    'path' => env('SESSION_PATH', '/'),

    /*
    |--------------------------------------------------------------------------
    | Session Cookie Domain
    |--------------------------------------------------------------------------
    |
    | This value determines the domain and subdomains the session cookie is
    | available to. By default, the cookie will be available to the root
    | domain without subdomains. Typically, this shouldn't be changed.
    |
    */

    'domain' => env('SESSION_DOMAIN'),

    /*
    |--------------------------------------------------------------------------
    | HTTPS Only Cookies
    |--------------------------------------------------------------------------
    |
    | By setting this option to true, session cookies will only be sent back
    | to the server if the browser has a HTTPS connection. This will keep
    | the cookie from being sent to you when it can't be done securely.
    |
    */

    'secure' => env('SESSION_SECURE_COOKIE'),

    /*
    |--------------------------------------------------------------------------
    | HTTP Access Only
    |--------------------------------------------------------------------------
    |
    | Setting this value to true will prevent JavaScript from accessing the
    | value of the cookie and the cookie will only be accessible through
    | the HTTP protocol. It's unlikely you should disable this option.
    |
    */

    'http_only' => env('SESSION_HTTP_ONLY', true),

    /*
    |--------------------------------------------------------------------------
    | Same-Site Cookies
    |--------------------------------------------------------------------------
    |
    | This option determines how your cookies behave when cross-site requests
    | take place, and can be used to mitigate CSRF attacks. By default, we
    | will set this value to "lax" to permit secure cross-site requests.
    |
    | See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#samesitesamesite-value
    |
    | Supported: "lax", "strict", "none", null
    |
    */

    'same_site' => env('SESSION_SAME_SITE', 'lax'),

    /*
    |--------------------------------------------------------------------------
    | Partitioned Cookies
    |--------------------------------------------------------------------------
    |
    | Setting this value to true will tie the cookie to the top-level site for
    | a cross-site context. Partitioned cookies are accepted by the browser
    | when flagged "secure" and the Same-Site attribute is set to "none".
    |
    */

    'partitioned' => env('SESSION_PARTITIONED_COOKIE', false),

];


### FILE: src/database/factories/CityFactory.php
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Models\City>
 */
class CityFactory extends Factory
{
    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            // ランダムに選んだ都道府県のIDを入れる
            'prefecture_id' => \App\Models\Prefecture::inRandomOrder()->first()->id,
            // 架空の市名を生成
            'name' => fake()->city(),
            'code' => fake()->randomNumber(5, true),
        ];
    }
}


### FILE: src/database/factories/RestaurantFactory.php
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Models\Restaurant>
 */
class RestaurantFactory extends Factory
{
    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            // ユーザーとエリアも自動で一緒に作る設定
            'user_id' => \App\Models\User::factory(),
            'city_id' => \App\Models\City::factory(),
            
            'name' => fake()->company() . '食堂',
            'description' => fake()->realText(50),
            'address_detail' => fake()->streetAddress(),
            'phone_number' => fake()->phoneNumber(),
            'open_time' => '10:00:00',
            'close_time' => '22:00:00',
        ];
    }
}


### FILE: src/database/factories/UserFactory.php
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Str;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Models\User>
 */
class UserFactory extends Factory
{
    /**
     * The current password being used by the factory.
     */
    protected static ?string $password;

    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            'name' => fake()->name(),
            'email' => fake()->unique()->safeEmail(),
            'email_verified_at' => now(),
            'password' => static::$password ??= Hash::make('password'),
            'remember_token' => Str::random(10),
        ];
    }

    /**
     * Indicate that the model's email address should be unverified.
     */
    public function unverified(): static
    {
        return $this->state(fn (array $attributes) => [
            'email_verified_at' => null,
        ]);
    }
}


### FILE: src/database/migrations/0001_01_01_000000_create_users_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('users', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('email')->unique();
            $table->timestamp('email_verified_at')->nullable();
            $table->string('password');
            $table->rememberToken();
            $table->timestamps();
        });

        Schema::create('password_reset_tokens', function (Blueprint $table) {
            $table->string('email')->primary();
            $table->string('token');
            $table->timestamp('created_at')->nullable();
        });

        Schema::create('sessions', function (Blueprint $table) {
            $table->string('id')->primary();
            $table->foreignId('user_id')->nullable()->index();
            $table->string('ip_address', 45)->nullable();
            $table->text('user_agent')->nullable();
            $table->longText('payload');
            $table->integer('last_activity')->index();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('users');
        Schema::dropIfExists('password_reset_tokens');
        Schema::dropIfExists('sessions');
    }
};


### FILE: src/database/migrations/0001_01_01_000001_create_cache_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('cache', function (Blueprint $table) {
            $table->string('key')->primary();
            $table->mediumText('value');
            $table->integer('expiration')->index();
        });

        Schema::create('cache_locks', function (Blueprint $table) {
            $table->string('key')->primary();
            $table->string('owner');
            $table->integer('expiration')->index();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('cache');
        Schema::dropIfExists('cache_locks');
    }
};


### FILE: src/database/migrations/0001_01_01_000002_create_jobs_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('jobs', function (Blueprint $table) {
            $table->id();
            $table->string('queue')->index();
            $table->longText('payload');
            $table->unsignedTinyInteger('attempts');
            $table->unsignedInteger('reserved_at')->nullable();
            $table->unsignedInteger('available_at');
            $table->unsignedInteger('created_at');
        });

        Schema::create('job_batches', function (Blueprint $table) {
            $table->string('id')->primary();
            $table->string('name');
            $table->integer('total_jobs');
            $table->integer('pending_jobs');
            $table->integer('failed_jobs');
            $table->longText('failed_job_ids');
            $table->mediumText('options')->nullable();
            $table->integer('cancelled_at')->nullable();
            $table->integer('created_at');
            $table->integer('finished_at')->nullable();
        });

        Schema::create('failed_jobs', function (Blueprint $table) {
            $table->id();
            $table->string('uuid')->unique();
            $table->text('connection');
            $table->text('queue');
            $table->longText('payload');
            $table->longText('exception');
            $table->timestamp('failed_at')->useCurrent();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('jobs');
        Schema::dropIfExists('job_batches');
        Schema::dropIfExists('failed_jobs');
    }
};


### FILE: src/database/migrations/2026_01_27_000000_create_prefectures_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('prefectures', function (Blueprint $table) {
            $table->id();
            $table->string('name'); // 都道府県名
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('prefectures');
    }
};


### FILE: src/database/migrations/2026_01_27_000001_create_cities_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
   public function up(): void
    {
        Schema::create('cities', function (Blueprint $table) {
            $table->id();
            // 都道府県との紐付け
            $table->foreignId('prefecture_id')->constrained()->cascadeOnDelete();
            $table->string('name'); // 市区町村名
            $table->string('code')->nullable(); // 自治体コードなど
            $table->timestamps();
        });
    }
    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('cities');
    }
};


### FILE: src/database/migrations/2026_01_28_021622_create_restaurants_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('restaurants', function (Blueprint $table) {
            $table->id();

            // 外部キー（紐付け）
            // ユーザー(オーナー)が消えたら、その人の店も消える設定
            $table->foreignId('user_id')->constrained()->cascadeOnDelete();
            // 市区町村が消えたら、そのエリアの店も消える設定
            $table->foreignId('city_id')->constrained()->cascadeOnDelete();

            // 店舗の基本情報
            $table->string('name'); // 店名
            $table->text('description')->nullable(); // 説明文（長文OK・空でもOK）
            $table->string('address_detail')->nullable(); // 番地・ビル名
            $table->string('phone_number')->nullable(); // 電話番号
            
            // 営業時間（時間データのみ）
            $table->time('open_time')->nullable(); 
            $table->time('close_time')->nullable();

            $table->timestamps(); // 作成日・更新日
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('restaurants');
    }
};

### FILE: src/database/migrations/2026_01_28_022024_create_genres_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
   public function up(): void
    {
        Schema::create('genres', function (Blueprint $table) {
            $table->id();
            $table->string('name')->unique(); // ジャンル名（重複禁止）
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('genres');
    }
};


### FILE: src/database/migrations/2026_01_28_022034_create_restaurant_genre_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        // テーブル名は単数形同士をアルファベット順（genre_restaurant）にするのが
        // Laravelの慣習ですが、今回はわかりやすく restaurant_genre にしています。
        Schema::create('restaurant_genre', function (Blueprint $table) {
            $table->id();

            // どの店が？
            $table->foreignId('restaurant_id')->constrained()->cascadeOnDelete();
            // どのジャンル？
            $table->foreignId('genre_id')->constrained()->cascadeOnDelete();

            $table->timestamps();

            // 「A店は焼肉」というデータが2回登録されないようにする制限
            $table->unique(['restaurant_id', 'genre_id']);
        });
    }
    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('restaurant_genre');
    }
};


### FILE: src/database/migrations/2026_01_28_022518_create_menu_items_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('menu_items', function (Blueprint $table) {
            $table->id();

            // どの店のメニュー？（店が消えたらメニューも消える）
            $table->foreignId('restaurant_id')->constrained()->cascadeOnDelete();

            $table->string('name'); // 料理名
            $table->integer('price'); // 価格
            $table->text('description')->nullable(); // 料理の説明

            $table->timestamps();
        });
    }
    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('menu_items');
    }
};


### FILE: src/database/migrations/2026_01_28_022524_create_menu_item_images_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('menu_item_images', function (Blueprint $table) {
            $table->id();

            // どの料理の画像？（料理が消えたら画像も消える）
            $table->foreignId('menu_item_id')->constrained()->cascadeOnDelete();

            $table->string('image_url'); // 画像のパス（S3やstorageの場所）
            $table->string('alt_text')->nullable(); // 画像の説明（SEO用など）

            $table->timestamps();
        });
    }
    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('menu_item_images');
    }
};


### FILE: src/database/migrations/2026_01_28_023256_create_reviews_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('reviews', function (Blueprint $table) {
            $table->id();
            // 外部キー制約（ユーザーが消えたら口コミも消える）
            $table->foreignId('user_id')->constrained()->cascadeOnDelete();
            $table->foreignId('restaurant_id')->constrained()->cascadeOnDelete();
            $table->integer('rating'); // 星評価 (1-5)
            $table->text('comment');   // コメント
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('reviews');
    }
};


### FILE: src/database/migrations/2026_01_28_023301_create_favorites_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('favorites', function (Blueprint $table) {
            $table->id();
            $table->foreignId('user_id')->constrained()->cascadeOnDelete();
            $table->foreignId('restaurant_id')->constrained()->cascadeOnDelete();
            $table->timestamps();
            
            // 重複禁止（1人のユーザーが同じ店を2回お気に入りできない）
            $table->unique(['user_id', 'restaurant_id']);
        });
    }
    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('favorites');
    }
};


### FILE: src/database/migrations/2026_01_28_063934_create_review_images_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
   public function up(): void
    {
        Schema::create('review_images', function (Blueprint $table) {
            $table->id();
            // どのレビューの画像か？
            $table->foreignId('review_id')->constrained()->cascadeOnDelete();
            // 画像の保存場所（パス）
            $table->string('image_path');
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('review_images');
    }
};


### FILE: src/database/migrations/2026_02_02_040915_create_restaurant_images_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('restaurant_images', function (Blueprint $table) {
            $table->id();
            // 店舗ID（外部キー）
            $table->foreignId('restaurant_id')->constrained()->onDelete('cascade');
            // 画像パス
            $table->string('image_path');
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('restaurant_images');
    }
};


### FILE: src/database/migrations/2026_02_02_054158_add_role_id_to_users_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::table('users', function (Blueprint $table) {
            // 1:一般, 2:店舗主 (デフォルトは1)
            // emailカラムの後ろに追加
            $table->tinyInteger('role_id')->default(1)->after('email');
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::table('users', function (Blueprint $table) {
            $table->dropColumn('role_id');
        });
    }
};

### FILE: src/database/migrations/2026_02_02_065209_add_details_to_restaurants_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::table('restaurants', function (Blueprint $table) {
            // まだカラムが存在しない場合のみ追加する安全策
            if (!Schema::hasColumn('restaurants', 'nearest_station')) {
                $table->string('nearest_station')->nullable()->after('city_id');
            }
            if (!Schema::hasColumn('restaurants', 'menu_info')) {
                $table->text('menu_info')->nullable()->after('description');
            }
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::table('restaurants', function (Blueprint $table) {
            $table->dropColumn(['nearest_station', 'menu_info']);
        });
    }
};

### FILE: src/database/migrations/2026_02_02_071655_add_address_to_restaurants_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::table('restaurants', function (Blueprint $table) {
            // city_id の後ろに住所カラムを追加
            if (!Schema::hasColumn('restaurants', 'address')) {
                $table->string('address')->nullable()->after('city_id');
            }
        });
    }

    public function down(): void
    {
        Schema::table('restaurants', function (Blueprint $table) {
            $table->dropColumn('address');
        });
    }
};

### FILE: src/database/migrations/2026_02_03_052901_add_coordinates_to_restaurants_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        // カラムがまだ無い場合のみ追加処理を行う（これでエラーを回避できます）
        if (!Schema::hasColumn('restaurants', 'latitude')) {
            Schema::table('restaurants', function (Blueprint $table) {
                $table->double('latitude', 10, 8)->nullable()->after('address')->comment('緯度');
                $table->double('longitude', 11, 8)->nullable()->after('latitude')->comment('経度');
            });
        }
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::table('restaurants', function (Blueprint $table) {
            $table->dropColumn(['latitude', 'longitude']);
        });
    }
};

### FILE: src/database/migrations/2026_02_04_065837_create_restaurant_seat_types_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
  public function up(): void
    {
        Schema::create('restaurant_seat_types', function (Blueprint $table) {
            $table->id();
            // どのお店か
            $table->foreignId('restaurant_id')->constrained()->cascadeOnDelete();
            // 席の名前（例: カウンター席、4名テーブル）
            $table->string('name');
            // そのタイプの席数・卓数
            $table->integer('capacity');
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('restaurant_seat_types');
    }
};


### FILE: src/database/migrations/2026_02_04_065843_create_restaurant_time_settings_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
   public function up(): void
    {
        Schema::create('restaurant_time_settings', function (Blueprint $table) {
            $table->id();
            $table->foreignId('restaurant_id')->constrained()->cascadeOnDelete();
            // 曜日 (0:日曜, 1:月曜... 7:祝日)
            $table->integer('day_of_week');
            // 時間帯（11:00〜14:00など）
            $table->time('start_time');
            $table->time('end_time');
            // この時間帯の滞在可能時間（分単位）
            $table->integer('stay_minutes');
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('restaurant_time_settings');
    }
};


### FILE: src/database/migrations/2026_02_04_065848_create_reservations_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
   public function up(): void
    {
        Schema::create('reservations', function (Blueprint $table) {
            $table->id();
            // 誰が、どの店の、どの席タイプを
            $table->foreignId('user_id')->constrained()->cascadeOnDelete();
            $table->foreignId('restaurant_id')->constrained()->cascadeOnDelete();
            $table->foreignId('restaurant_seat_type_id')->constrained()->cascadeOnDelete();
            
            // 予約日時
            $table->dateTime('reserved_at');
            // 終了日時（重複チェックを高速化するために保存）
            $table->dateTime('end_at');
            
            // 人数
            $table->integer('number_of_people');
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('reservations');
    }
};


### FILE: src/database/migrations/2026_02_04_065852_add_capacity_to_restaurants_table.php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::table('restaurants', function (Blueprint $table) {
            // アドレスの後ろに追加、初期値は0
            $table->integer('capacity')->default(0)->after('address');
        });
    }

    public function down(): void
    {
        Schema::table('restaurants', function (Blueprint $table) {
            $table->dropColumn('capacity');
        });
    }
};


### FILE: src/database/seeders/AdminUserSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\User;
use Illuminate\Support\Facades\Hash;

class AdminUserSeeder extends Seeder
{
    public function run(): void
    {
        // 既に存在しない場合のみ作成
        if (!User::where('email', 'admin@example.com')->exists()) {
            User::create([
                'name' => 'システム管理者',
                'email' => 'admin@example.com',
                'password' => Hash::make('password123'), // 任意のパスワード
                'role_id' => 3, // ★重要：管理者は 3 とする
            ]);
        }
    }
}

### FILE: src/database/seeders/CitySeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\City;
use App\Models\Prefecture;
use Illuminate\Support\Facades\Schema;
use Normalizer; // ★追加：正規化用クラス

class CitySeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        Schema::disableForeignKeyConstraints();
        City::truncate();
        Schema::enableForeignKeyConstraints();

        $data = [
            '北海道' => '札幌市',
            '青森県' => '青森市',
            '岩手県' => '盛岡市',
            '宮城県' => '仙台市',
            '秋田県' => '秋田市',
            '山形県' => '山形市',
            '福島県' => '福島市',
            '茨城県' => '水戸市',
            '栃木県' => '宇都宮市',
            '群馬県' => '前橋市',
            '埼玉県' => 'さいたま市',
            '千葉県' => '千葉市',
            '東京都' => [
                '千代田区', '中央区', '港区', '新宿区', '文京区', '台東区', '墨田区',
                '江東区', '品川区', '目黒区', '大田区', '世田谷区', '渋谷区', '中野区',
                '杉並区', '豊島区', '北区', '荒川区', '板橋区', '練馬区', '足立区',
                '葛飾区', '江戸川区'
            ],
            '神奈川県' => '横浜市',
            '新潟県' => '新潟市',
            '富山県' => '富山市',
            '石川県' => '金沢市',
            '福井県' => '福井市',
            '山梨県' => '甲府市',
            '長野県' => '長野市',
            '岐阜県' => '岐阜市',
            '静岡県' => '静岡市',
            '愛知県' => '名古屋市',
            '三重県' => '津市',
            '滋賀県' => '大津市',
            '京都府' => '京都市',
            '大阪府' => '大阪市',
            '兵庫県' => '神戸市',
            '奈良県' => '奈良市',
            '和歌山県' => '和歌山市',
            '鳥取県' => '鳥取市',
            '島根県' => '松江市',
            '岡山県' => '岡山市',
            '広島県' => '広島市',
            '山口県' => '山口市',
            '徳島県' => '徳島市',
            '香川県' => '高松市',
            '愛媛県' => '松山市',
            '高知県' => '高知市',
            '福岡県' => '福岡市',
            '佐賀県' => '佐賀市',
            '長崎県' => '長崎市',
            '熊本県' => '熊本市',
            '大分県' => '大分市',
            '宮崎県' => '宮崎市',
            '鹿児島県' => '鹿児島市',
            '沖縄県' => '那覇市',
        ];

        foreach ($data as $prefName => $cities) {
            $prefecture = Prefecture::where('name', $prefName)->first();

            if (!$prefecture) {
                continue;
            }

            // 配列か文字列かを統一して処理しやすくする
            $cityList = is_array($cities) ? $cities : [$cities];

            foreach ($cityList as $cityName) {
                // ★正規化処理（NFKC形式）
                // 半角カナ→全角、全角英数→半角、合成文字の分解・統合などを行う
                if (class_exists('Normalizer')) {
                    $normalizedCityName = Normalizer::normalize($cityName, Normalizer::FORM_KC);
                } else {
                    $normalizedCityName = $cityName; // 拡張モジュールがない場合のフォールバック
                }

                City::create([
                    'prefecture_id' => $prefecture->id,
                    'name' => $normalizedCityName,
                ]);
            }
        }
    }
}

### FILE: src/database/seeders/DatabaseSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    /**
     * Seed the application's database.
     */
    public function run(): void
    {
        // ▼▼▼ 注意：ここの記述を確認してください ▼▼▼
        
        // もし以下のような Factory の記述があったら、必ず削除またはコメントアウトしてください。
        // これらが残っていると、勝手にアルファベットの出鱈目なデータが作られてしまいます。
        // \App\Models\User::factory(10)->create();
        // \App\Models\Restaurant::factory(10)->create(); 
        // \App\Models\City::factory(10)->create();

        // ▼▼▼ 正しい記述：作成したSeederだけを順番に呼び出します ▼▼▼
        $this->call([
            // 1. まず県データを作る
            PrefectureSeeder::class,
            // 2. 次に市町村データを作る（県データが必要だから2番目）
            CitySeeder::class,
            // 3. 最後に店舗データを作る（市データが必要だから3番目）
            RestaurantSeeder::class,
            
            // ユーザーなどのデータも必要であればここに追加
            // UserSeeder::class, 
        ]);
    }
}

### FILE: src/database/seeders/GenreSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Genre;

class GenreSeeder extends Seeder
{
    public function run(): void
    {
        $genres = [
            'イタリアン', 'フレンチ', '和食', '寿司', '焼肉',
            'ラーメン', '居酒屋', 'カフェ', 'スイーツ', '中華料理',
            '韓国料理', 'カレー', 'ハンバーガー', 'バー'
        ];

        foreach ($genres as $name) {
            Genre::create(['name' => $name]);
        }
    }
}

### FILE: src/database/seeders/PrefectureSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Prefecture;

class PrefectureSeeder extends Seeder
{
    public function run(): void
    {
        $prefectures = [
            '北海道', '青森県', '岩手県', '宮城県', '秋田県', '山形県', '福島県',
            '茨城県', '栃木県', '群馬県', '埼玉県', '千葉県', '東京都', '神奈川県',
            '新潟県', '富山県', '石川県', '福井県', '山梨県', '長野県', '岐阜県',
            '静岡県', '愛知県', '三重県', '滋賀県', '京都府', '大阪府', '兵庫県',
            '奈良県', '和歌山県', '鳥取県', '島根県', '岡山県', '広島県', '山口県',
            '徳島県', '香川県', '愛媛県', '高知県', '福岡県', '佐賀県', '長崎県',
            '熊本県', '大分県', '宮崎県', '鹿児島県', '沖縄県'
        ];

        foreach ($prefectures as $name) {
            Prefecture::create(['name' => $name]);
        }
    }
}

### FILE: src/database/seeders/RealAddressRestaurantSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;
use App\Models\Restaurant;
use App\Models\City;
use App\Models\User;
use Faker\Factory as Faker;

class RealAddressRestaurantSeeder extends Seeder
{
    /**
     * 実在する住所、座標、最寄り駅を持つダミー店舗を生成
     */
    public function run(): void
    {
        // 1. 既存の店舗データを削除
        DB::statement('SET FOREIGN_KEY_CHECKS=0;');
        Restaurant::truncate();
        DB::statement('SET FOREIGN_KEY_CHECKS=1;');

        $faker = Faker::create('ja_JP');

        // 店舗オーナー用のユーザーIDを取得
        $user = User::first() ?? User::factory()->create();

        // 実在する住所・座標・最寄り駅のリスト
        $locations = [
            [
                'city_name' => '千代田区',
                'address' => '丸の内1-9-1 グラン東京ノースタワー',
                'lat' => 35.681236, 'lng' => 139.767125,
                'station' => '東京駅'
            ],
            [
                'city_name' => '新宿区',
                'address' => '西新宿2-8-1',
                'lat' => 35.689634, 'lng' => 139.692101,
                'station' => '都庁前駅'
            ],
            [
                'city_name' => '渋谷区',
                'address' => '宇田川町15-1 渋谷パルコ',
                'lat' => 35.662058, 'lng' => 139.698375,
                'station' => '渋谷駅'
            ],
            [
                'city_name' => '札幌市',
                'address' => '中央区北5条西2丁目5 JRタワー',
                'lat' => 43.068661, 'lng' => 141.350755,
                'station' => '札幌駅'
            ],
            [
                'city_name' => '大阪市',
                'address' => '北区梅田3-1-1 グランフロント大阪',
                'lat' => 34.702485, 'lng' => 135.495951,
                'station' => '大阪駅'
            ],
            [
                'city_name' => '京都市',
                'address' => '下京区烏丸通塩小路下ル 京都駅ビル',
                'lat' => 34.985849, 'lng' => 135.758767,
                'station' => '京都駅'
            ],
            [
                'city_name' => '福岡市',
                'address' => '博多区博多駅中央街1-1 JR博多シティ',
                'lat' => 33.589728, 'lng' => 130.420727,
                'station' => '博多駅'
            ],
            [
                'city_name' => '横浜市',
                'address' => '西区みなとみらい2-2-1 ランドマークタワー',
                'lat' => 35.454980, 'lng' => 139.631267,
                'station' => 'みなとみらい駅'
            ],
            [
                'city_name' => '名古屋市',
                'address' => '中村区名駅1-1-4 JRセントラルタワーズ',
                'lat' => 35.170915, 'lng' => 136.881537,
                'station' => '名古屋駅'
            ],
            [
                'city_name' => '神戸市',
                'address' => '中央区東川崎町1-6-1 モザイク',
                'lat' => 34.678456, 'lng' => 135.184373,
                'station' => '神戸駅'
            ]
        ];

        foreach ($locations as $loc) {
            // CityIDの取得（なければ1）
            $city = City::where('name', 'like', "%{$loc['city_name']}%")->first();
            $city_id = $city ? $city->id : 1;

            Restaurant::create([
                'user_id' => $user->id,
                'city_id' => $city_id,
                'name' => $faker->lastName . '食堂 ' . $loc['city_name'] . '店',
                
                'address' => $loc['address'],
                'latitude' => $loc['lat'],
                'longitude' => $loc['lng'],
                
                // ここで設定したリアルな駅名を使用
                'nearest_station' => $loc['station'],
                
                'description' => $faker->realText(50),
                'menu_info' => $faker->realText(50),
                
                'created_at' => now(),
                'updated_at' => now(),
            ]);
        }
    }
}

### FILE: src/database/seeders/RestaurantSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Restaurant;
use App\Models\City;
use App\Models\User;
use App\Models\RestaurantSeatType; // ★追加
use App\Models\RestaurantTimeSetting; // ★追加
use Illuminate\Support\Facades\Schema;
use Illuminate\Support\Facades\Hash;

class RestaurantSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        Schema::disableForeignKeyConstraints();
        // 親テーブルを消す前に子テーブルもクリーンにする（外部キー制約回避のため）
        RestaurantTimeSetting::truncate();
        RestaurantSeatType::truncate();
        Restaurant::truncate();
        Schema::enableForeignKeyConstraints();

        if (City::count() === 0) {
            $this->call(CitySeeder::class);
        }

        // 管理者ユーザーを作成
        $user = User::firstOrCreate(
            ['email' => 'admin@example.com'],
            [
                'name' => '管理者太郎',
                'password' => Hash::make('password'),
                'email_verified_at' => now(),
            ]
        );

        // サンプル店舗データ
        $restaurants = [
            [
                'name' => '麺屋 太郎',
                'description' => '濃厚な豚骨スープと自家製麺が自慢の一杯。ランチタイムは行列必至です。',
                'genre' => '豚骨', 
            ],
            [
                'name' => '中華そば 青葉',
                'description' => '昔ながらの醤油ラーメン。鶏ガラベースの透き通ったスープに心が安らぎます。',
                'genre' => '醤油',
            ],
            [
                'name' => '味噌乃家',
                'description' => '北海道産の味噌をふんだんに使用した、コクのある味噌ラーメン専門店。',
                'genre' => '味噌',
            ],
            [
                'name' => '海鮮ラーメン 潮騒',
                'description' => '新鮮な魚介をたっぷりトッピング。スープまで飲み干せる塩ラーメンです。',
                'genre' => '塩',
            ],
            [
                'name' => '激辛タンメン ファイヤー',
                'description' => '辛いもの好きにはたまらない！特製ラー油と唐辛子が効いた刺激的な一杯。',
                'genre' => '激辛',
            ],
            [
                'name' => 'つけ麺 大王',
                'description' => '極太麺を濃厚な魚介豚骨スープにくぐらせて。並盛・中盛・大盛が同料金！',
                'genre' => 'つけ麺',
            ],
            [
                'name' => '鶏白湯 ほっこり',
                'description' => '鶏の旨味を凝縮したクリーミーなスープ。女性にも大人気のヘルシーラーメン。',
                'genre' => '鶏白湯',
            ],
            [
                'name' => '油そば ぶぶか',
                'description' => 'スープのないラーメン「油そば」。特製タレと麺を豪快に混ぜてお召し上がりください。',
                'genre' => '油そば',
            ],
        ];

        foreach ($restaurants as $data) {
            $city = City::inRandomOrder()->first();

            // 1. 店舗を作成
            $restaurant = Restaurant::create([
                'user_id' => $user->id,
                'name' => $data['name'],
                'city_id' => $city->id,
                'address_detail' => '駅前 1-2-3',
                'description' => $data['description'],
                'open_time' => '11:00',
                'close_time' => '22:00',
                'capacity' => 22, // ★追加: 総定員（カウンター10 + テーブル3卓(12) = 22名想定）
            ]);

            // 2. 席タイプを作成（★追加部分）
            // カウンター席: 10席
            RestaurantSeatType::create([
                'restaurant_id' => $restaurant->id,
                'name' => 'カウンター',
                'capacity' => 10,
            ]);

            // テーブル席: 3卓
            RestaurantSeatType::create([
                'restaurant_id' => $restaurant->id,
                'name' => 'テーブル（4名席）',
                'capacity' => 3,
            ]);

            // 3. 時間設定を作成（★追加部分）
            // 全曜日（0=日曜 〜 6=土曜）に対して同じ設定を入れる
            for ($day = 0; $day <= 6; $day++) {
                // ランチ: 11:00〜15:00 (滞在60分)
                RestaurantTimeSetting::create([
                    'restaurant_id' => $restaurant->id,
                    'day_of_week' => $day,
                    'start_time' => '11:00',
                    'end_time' => '15:00',
                    'stay_minutes' => 60,
                ]);

                // ディナー: 17:00〜22:00 (滞在90分)
                RestaurantTimeSetting::create([
                    'restaurant_id' => $restaurant->id,
                    'day_of_week' => $day,
                    'start_time' => '17:00',
                    'end_time' => '22:00',
                    'stay_minutes' => 90,
                ]);
            }
        }
    }
}

### FILE: src/postcss.config.js
export default {
    plugins: {
        tailwindcss: {},
        autoprefixer: {},
    },
};


### FILE: src/public/index.php
<?php

use Illuminate\Foundation\Application;
use Illuminate\Http\Request;

define('LARAVEL_START', microtime(true));

// Determine if the application is in maintenance mode...
if (file_exists($maintenance = __DIR__.'/../storage/framework/maintenance.php')) {
    require $maintenance;
}

// Register the Composer autoloader...
require __DIR__.'/../vendor/autoload.php';

// Bootstrap Laravel and handle the request...
/** @var Application $app */
$app = require_once __DIR__.'/../bootstrap/app.php';

$app->handleRequest(Request::capture());


### FILE: src/resources/css/app.css
@tailwind base;
@tailwind components;
@tailwind utilities;


### FILE: src/resources/js/app.js
import './bootstrap';

import Alpine from 'alpinejs';

window.Alpine = Alpine;

Alpine.start();


### FILE: src/resources/js/bootstrap.js
import axios from 'axios';
window.axios = axios;

window.axios.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';


### FILE: src/resources/views/admin/dashboard.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-red-600 leading-tight">
            🛠️ 管理者ダッシュボード
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-8">

            {{-- メッセージ表示 --}}
            @if(session('success'))
                <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4" role="alert">
                    <p>{{ session('success') }}</p>
                </div>
            @endif
            @if(session('error'))
                <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4" role="alert">
                    <p>{{ session('error') }}</p>
                </div>
            @endif

            {{-- 1. ユーザー管理エリア --}}
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 text-gray-900">
                    <h3 class="text-lg font-bold mb-4 border-b pb-2 flex items-center gap-2">
                        👤 ユーザー管理 <span class="text-sm font-normal text-gray-500">({{ $users->count() }}名)</span>
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-left text-sm whitespace-nowrap">
                            <thead class="uppercase tracking-wider border-b-2 border-gray-200 bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3">ID</th>
                                    <th class="px-4 py-3">名前</th>
                                    <th class="px-4 py-3">Email</th>
                                    <th class="px-4 py-3">権限</th>
                                    <th class="px-4 py-3 text-right">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach($users as $user)
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="px-4 py-3">{{ $user->id }}</td>
                                        <td class="px-4 py-3 font-bold">{{ $user->name }}</td>
                                        <td class="px-4 py-3">{{ $user->email }}</td>
                                        <td class="px-4 py-3">
                                            @if($user->role_id == 3) <span class="text-red-600 font-bold">管理者</span>
                                            @elseif($user->role_id == 2) <span class="text-blue-600 font-bold">店舗代表</span>
                                            @else 一般 @endif
                                        </td>
                                        <td class="px-4 py-3 text-right">
                                            @if($user->id !== Auth::id())
                                                <form action="{{ route('admin.users.destroy', $user->id) }}" method="POST" onsubmit="return confirm('本当にこのユーザーを削除しますか？\n関連するデータも削除される可能性があります。');">
                                                    @csrf @method('DELETE')
                                                    <button class="text-red-500 hover:text-red-700 font-bold border border-red-200 px-3 py-1 rounded hover:bg-red-50">削除</button>
                                                </form>
                                            @else
                                                <span class="text-gray-400 text-xs">自分</span>
                                            @endif
                                        </td>
                                    </tr>
                                @endforeach
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            {{-- 2. 店舗管理エリア --}}
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 text-gray-900">
                    <h3 class="text-lg font-bold mb-4 border-b pb-2 flex items-center gap-2">
                        🍜 店舗管理 <span class="text-sm font-normal text-gray-500">({{ $restaurants->count() }}件)</span>
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-left text-sm whitespace-nowrap">
                            <thead class="uppercase tracking-wider border-b-2 border-gray-200 bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3">ID</th>
                                    <th class="px-4 py-3">店舗名</th>
                                    <th class="px-4 py-3">オーナー</th>
                                    <th class="px-4 py-3">住所</th>
                                    <th class="px-4 py-3 text-right">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach($restaurants as $restaurant)
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="px-4 py-3">{{ $restaurant->id }}</td>
                                        <td class="px-4 py-3 font-bold">
                                            <a href="{{ route('restaurants.show', $restaurant->id) }}" class="text-blue-600 hover:underline" target="_blank">
                                                {{ $restaurant->name }} ↗
                                            </a>
                                        </td>
                                        <td class="px-4 py-3">{{ $restaurant->user->name ?? '不明' }}</td>
                                        <td class="px-4 py-3 text-gray-500 truncate max-w-xs">{{ $restaurant->address }}</td>
                                        <td class="px-4 py-3 text-right">
                                            <form action="{{ route('admin.restaurants.destroy', $restaurant->id) }}" method="POST" onsubmit="return confirm('本当にこの店舗を削除しますか？');">
                                                @csrf @method('DELETE')
                                                <button class="text-red-500 hover:text-red-700 font-bold border border-red-200 px-3 py-1 rounded hover:bg-red-50">削除</button>
                                            </form>
                                        </td>
                                    </tr>
                                @endforeach
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            {{-- 3. レビュー管理エリア --}}
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 text-gray-900">
                    <h3 class="text-lg font-bold mb-4 border-b pb-2 flex items-center gap-2">
                        💬 レビュー管理 <span class="text-sm font-normal text-gray-500">({{ $reviews->count() }}件)</span>
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-left text-sm whitespace-nowrap">
                            <thead class="uppercase tracking-wider border-b-2 border-gray-200 bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3">Date</th>
                                    <th class="px-4 py-3">投稿者</th>
                                    <th class="px-4 py-3">店舗名</th>
                                    <th class="px-4 py-3">評価</th>
                                    <th class="px-4 py-3">コメント</th>
                                    <th class="px-4 py-3 text-right">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach($reviews as $review)
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="px-4 py-3 text-gray-500 text-xs">{{ $review->created_at->format('Y/m/d') }}</td>
                                        <td class="px-4 py-3">{{ $review->user->name ?? '退会済み' }}</td>
                                        <td class="px-4 py-3 text-blue-600">{{ $review->restaurant->name ?? '削除済み' }}</td>
                                        <td class="px-4 py-3 text-yellow-500 font-bold">★{{ $review->rating }}</td>
                                        <td class="px-4 py-3 text-gray-600 truncate max-w-xs" title="{{ $review->comment }}">{{ $review->comment }}</td>
                                        <td class="px-4 py-3 text-right">
                                            <form action="{{ route('admin.reviews.destroy', $review->id) }}" method="POST" onsubmit="return confirm('このレビューを強制削除しますか？');">
                                                @csrf @method('DELETE')
                                                <button class="text-red-500 hover:text-red-700 font-bold border border-red-200 px-3 py-1 rounded hover:bg-red-50">削除</button>
                                            </form>
                                        </td>
                                    </tr>
                                @endforeach
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>
</x-app-layout>

### FILE: src/resources/views/auth/confirm-password.blade.php
<x-guest-layout>
    <div class="mb-4 text-sm text-gray-600">
        {{ __('This is a secure area of the application. Please confirm your password before continuing.') }}
    </div>

    <form method="POST" action="{{ route('password.confirm') }}">
        @csrf

        <!-- Password -->
        <div>
            <x-input-label for="password" :value="__('Password')" />

            <x-text-input id="password" class="block mt-1 w-full"
                            type="password"
                            name="password"
                            required autocomplete="current-password" />

            <x-input-error :messages="$errors->get('password')" class="mt-2" />
        </div>

        <div class="flex justify-end mt-4">
            <x-primary-button>
                {{ __('Confirm') }}
            </x-primary-button>
        </div>
    </form>
</x-guest-layout>


### FILE: src/resources/views/auth/forgot-password.blade.php
<x-guest-layout>
    <div class="mb-4 text-sm text-gray-600">
        {{ __('Forgot your password? No problem. Just let us know your email address and we will email you a password reset link that will allow you to choose a new one.') }}
    </div>

    <!-- Session Status -->
    <x-auth-session-status class="mb-4" :status="session('status')" />

    <form method="POST" action="{{ route('password.email') }}">
        @csrf

        <!-- Email Address -->
        <div>
            <x-input-label for="email" :value="__('Email')" />
            <x-text-input id="email" class="block mt-1 w-full" type="email" name="email" :value="old('email')" required autofocus />
            <x-input-error :messages="$errors->get('email')" class="mt-2" />
        </div>

        <div class="flex items-center justify-end mt-4">
            <x-primary-button>
                {{ __('Email Password Reset Link') }}
            </x-primary-button>
        </div>
    </form>
</x-guest-layout>


### FILE: src/resources/views/auth/login.blade.php
<x-guest-layout>
    <x-auth-session-status class="mb-4" :status="session('status')" />

    <form method="POST" action="{{ route('login') }}">
        @csrf

        <div>
            <x-input-label for="email" :value="'メールアドレス'" />
            <x-text-input id="email" class="block mt-1 w-full" type="email" name="email" :value="old('email')" required autofocus autocomplete="username" />
            <x-input-error :messages="$errors->get('email')" class="mt-2" />
        </div>

        <div class="mt-4">
            <x-input-label for="password" :value="'パスワード'" />

            <x-text-input id="password" class="block mt-1 w-full"
                            type="password"
                            name="password"
                            required autocomplete="current-password" />

            <x-input-error :messages="$errors->get('password')" class="mt-2" />
        </div>

        <div class="block mt-4">
            <label for="remember_me" class="inline-flex items-center">
                {{-- ★修正箇所：text-indigo-600 を text-orange-600 に変更 --}}
                <input id="remember_me" type="checkbox" class="rounded border-gray-300 text-orange-600 shadow-sm focus:ring-orange-500" name="remember">
                <span class="ms-2 text-sm text-gray-600">ログイン状態を保持する</span>
            </label>
        </div>

        <div class="flex items-center justify-end mt-4">
            @if (Route::has('password.request'))
                <a class="underline text-sm text-gray-600 hover:text-gray-900 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500" href="{{ route('password.request') }}">
                    パスワードを忘れた方
                </a>
            @endif

            <x-primary-button class="ms-3">
                ログイン
            </x-primary-button>
        </div>
    </form>
</x-guest-layout>

### FILE: src/resources/views/auth/register.blade.php
<x-guest-layout>
    <form method="POST" action="{{ route('register') }}">
        @csrf

        <div>
            <x-input-label for="name" :value="'お名前'" />
            <x-text-input id="name" class="block mt-1 w-full" type="text" name="name" :value="old('name')" required autofocus autocomplete="name" />
            <x-input-error :messages="$errors->get('name')" class="mt-2" />
        </div>

        <div class="mt-4">
            <x-input-label for="email" :value="'メールアドレス'" />
            <x-text-input id="email" class="block mt-1 w-full" type="email" name="email" :value="old('email')" required autocomplete="username" />
            <x-input-error :messages="$errors->get('email')" class="mt-2" />
        </div>

        <div class="mt-4">
            <x-input-label for="password" :value="'パスワード'" />

            <x-text-input id="password" class="block mt-1 w-full"
                            type="password"
                            name="password"
                            required autocomplete="new-password" />

            <x-input-error :messages="$errors->get('password')" class="mt-2" />
        </div>

        <div class="mt-4">
            <x-input-label for="password_confirmation" :value="'パスワード（確認）'" />

            <x-text-input id="password_confirmation" class="block mt-1 w-full"
                            type="password"
                            name="password_confirmation"
                            required autocomplete="new-password" />

            <x-input-error :messages="$errors->get('password_confirmation')" class="mt-2" />
        </div>

        <div class="mt-4">
            <span class="block font-medium text-sm text-gray-700">アカウント種別</span>
            <div class="mt-2 flex gap-6">
                {{-- 一般ユーザー --}}
                <label class="flex items-center cursor-pointer">
                    <input type="radio" name="role_id" value="1" class="w-4 h-4 text-orange-600 border-gray-300 focus:ring-orange-500" checked>
                    <span class="ml-2 text-gray-700">一般ユーザー</span>
                </label>
                
                {{-- 店舗代表者 --}}
                <label class="flex items-center cursor-pointer">
                    <input type="radio" name="role_id" value="2" class="w-4 h-4 text-orange-600 border-gray-300 focus:ring-orange-500">
                    <span class="ml-2 text-gray-700">店舗代表者</span>
                </label>
            </div>
        </div>

        <div class="flex items-center justify-end mt-4">
            <a class="underline text-sm text-gray-600 hover:text-gray-900 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500" href="{{ route('login') }}">
                既に登録済みの方はこちら
            </a>

            <x-primary-button class="ms-4">
                登録
            </x-primary-button>
        </div>
    </form>
</x-guest-layout>

### FILE: src/resources/views/auth/reset-password.blade.php
<x-guest-layout>
    <form method="POST" action="{{ route('password.store') }}">
        @csrf

        <!-- Password Reset Token -->
        <input type="hidden" name="token" value="{{ $request->route('token') }}">

        <!-- Email Address -->
        <div>
            <x-input-label for="email" :value="__('Email')" />
            <x-text-input id="email" class="block mt-1 w-full" type="email" name="email" :value="old('email', $request->email)" required autofocus autocomplete="username" />
            <x-input-error :messages="$errors->get('email')" class="mt-2" />
        </div>

        <!-- Password -->
        <div class="mt-4">
            <x-input-label for="password" :value="__('Password')" />
            <x-text-input id="password" class="block mt-1 w-full" type="password" name="password" required autocomplete="new-password" />
            <x-input-error :messages="$errors->get('password')" class="mt-2" />
        </div>

        <!-- Confirm Password -->
        <div class="mt-4">
            <x-input-label for="password_confirmation" :value="__('Confirm Password')" />

            <x-text-input id="password_confirmation" class="block mt-1 w-full"
                                type="password"
                                name="password_confirmation" required autocomplete="new-password" />

            <x-input-error :messages="$errors->get('password_confirmation')" class="mt-2" />
        </div>

        <div class="flex items-center justify-end mt-4">
            <x-primary-button>
                {{ __('Reset Password') }}
            </x-primary-button>
        </div>
    </form>
</x-guest-layout>


### FILE: src/resources/views/auth/verify-email.blade.php
<x-guest-layout>
    <div class="mb-4 text-sm text-gray-600">
        {{ __('Thanks for signing up! Before getting started, could you verify your email address by clicking on the link we just emailed to you? If you didn\'t receive the email, we will gladly send you another.') }}
    </div>

    @if (session('status') == 'verification-link-sent')
        <div class="mb-4 font-medium text-sm text-green-600">
            {{ __('A new verification link has been sent to the email address you provided during registration.') }}
        </div>
    @endif

    <div class="mt-4 flex items-center justify-between">
        <form method="POST" action="{{ route('verification.send') }}">
            @csrf

            <div>
                <x-primary-button>
                    {{ __('Resend Verification Email') }}
                </x-primary-button>
            </div>
        </form>

        <form method="POST" action="{{ route('logout') }}">
            @csrf

            <button type="submit" class="underline text-sm text-gray-600 hover:text-gray-900 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                {{ __('Log Out') }}
            </button>
        </form>
    </div>
</x-guest-layout>


### FILE: src/resources/views/components/application-logo.blade.php
<div style="font-size: 3rem;">🍜</div>


### FILE: src/resources/views/components/auth-session-status.blade.php
@props(['status'])

@if ($status)
    <div {{ $attributes->merge(['class' => 'font-medium text-sm text-green-600']) }}>
        {{ $status }}
    </div>
@endif


### FILE: src/resources/views/components/danger-button.blade.php
<button {{ $attributes->merge(['type' => 'submit', 'class' => 'inline-flex items-center px-4 py-2 bg-red-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-red-500 active:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition ease-in-out duration-150']) }}>
    {{ $slot }}
</button>


### FILE: src/resources/views/components/dropdown-link.blade.php
<a {{ $attributes->merge(['class' => 'block w-full px-4 py-2 text-start text-sm leading-5 text-gray-700 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 transition duration-150 ease-in-out']) }}>{{ $slot }}</a>


### FILE: src/resources/views/components/dropdown.blade.php
@props(['align' => 'right', 'width' => '48', 'contentClasses' => 'py-1 bg-white'])

@php
$alignmentClasses = match ($align) {
    'left' => 'ltr:origin-top-left rtl:origin-top-right start-0',
    'top' => 'origin-top',
    default => 'ltr:origin-top-right rtl:origin-top-left end-0',
};

$width = match ($width) {
    '48' => 'w-48',
    default => $width,
};
@endphp

<div class="relative" x-data="{ open: false }" @click.outside="open = false" @close.stop="open = false">
    <div @click="open = ! open">
        {{ $trigger }}
    </div>

    <div x-show="open"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-75"
            x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-95"
            class="absolute z-50 mt-2 {{ $width }} rounded-md shadow-lg {{ $alignmentClasses }}"
            style="display: none;"
            @click="open = false">
        <div class="rounded-md ring-1 ring-black ring-opacity-5 {{ $contentClasses }}">
            {{ $content }}
        </div>
    </div>
</div>


### FILE: src/resources/views/components/input-error.blade.php
@props(['messages'])

@if ($messages)
    <ul {{ $attributes->merge(['class' => 'text-sm text-red-600 space-y-1']) }}>
        @foreach ((array) $messages as $message)
            <li>{{ $message }}</li>
        @endforeach
    </ul>
@endif


### FILE: src/resources/views/components/input-label.blade.php
@props(['value'])

<label {{ $attributes->merge(['class' => 'block font-medium text-sm text-gray-700']) }}>
    {{ $value ?? $slot }}
</label>


### FILE: src/resources/views/components/modal.blade.php
@props([
    'name',
    'show' => false,
    'maxWidth' => '2xl'
])

@php
$maxWidth = [
    'sm' => 'sm:max-w-sm',
    'md' => 'sm:max-w-md',
    'lg' => 'sm:max-w-lg',
    'xl' => 'sm:max-w-xl',
    '2xl' => 'sm:max-w-2xl',
][$maxWidth];
@endphp

<div
    x-data="{
        show: @js($show),
        focusables() {
            // All focusable element types...
            let selector = 'a, button, input:not([type=\'hidden\']), textarea, select, details, [tabindex]:not([tabindex=\'-1\'])'
            return [...$el.querySelectorAll(selector)]
                // All non-disabled elements...
                .filter(el => ! el.hasAttribute('disabled'))
        },
        firstFocusable() { return this.focusables()[0] },
        lastFocusable() { return this.focusables().slice(-1)[0] },
        nextFocusable() { return this.focusables()[this.nextFocusableIndex()] || this.firstFocusable() },
        prevFocusable() { return this.focusables()[this.prevFocusableIndex()] || this.lastFocusable() },
        nextFocusableIndex() { return (this.focusables().indexOf(document.activeElement) + 1) % (this.focusables().length + 1) },
        prevFocusableIndex() { return Math.max(0, this.focusables().indexOf(document.activeElement)) -1 },
    }"
    x-init="$watch('show', value => {
        if (value) {
            document.body.classList.add('overflow-y-hidden');
            {{ $attributes->has('focusable') ? 'setTimeout(() => firstFocusable().focus(), 100)' : '' }}
        } else {
            document.body.classList.remove('overflow-y-hidden');
        }
    })"
    x-on:open-modal.window="$event.detail == '{{ $name }}' ? show = true : null"
    x-on:close-modal.window="$event.detail == '{{ $name }}' ? show = false : null"
    x-on:close.stop="show = false"
    x-on:keydown.escape.window="show = false"
    x-on:keydown.tab.prevent="$event.shiftKey || nextFocusable().focus()"
    x-on:keydown.shift.tab.prevent="prevFocusable().focus()"
    x-show="show"
    class="fixed inset-0 overflow-y-auto px-4 py-6 sm:px-0 z-50"
    style="display: {{ $show ? 'block' : 'none' }};"
>
    <div
        x-show="show"
        class="fixed inset-0 transform transition-all"
        x-on:click="show = false"
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
    >
        <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
    </div>

    <div
        x-show="show"
        class="mb-6 bg-white rounded-lg overflow-hidden shadow-xl transform transition-all sm:w-full {{ $maxWidth }} sm:mx-auto"
        x-transition:enter="ease-out duration-300"
        x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
        x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
    >
        {{ $slot }}
    </div>
</div>


### FILE: src/resources/views/components/nav-link.blade.php
@props(['active'])

@php
$classes = ($active ?? false)
            ? 'inline-flex items-center px-1 pt-1 border-b-2 border-indigo-400 text-sm font-medium leading-5 text-gray-900 focus:outline-none focus:border-indigo-700 transition duration-150 ease-in-out'
            : 'inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium leading-5 text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none focus:text-gray-700 focus:border-gray-300 transition duration-150 ease-in-out';
@endphp

<a {{ $attributes->merge(['class' => $classes]) }}>
    {{ $slot }}
</a>


### FILE: src/resources/views/components/primary-button.blade.php
<button {{ $attributes->merge(['type' => 'submit', 'class' => 'inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 focus:bg-gray-700 active:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition ease-in-out duration-150']) }}>
    {{ $slot }}
</button>


### FILE: src/resources/views/components/responsive-nav-link.blade.php
@props(['active'])

@php
$classes = ($active ?? false)
            ? 'block w-full ps-3 pe-4 py-2 border-l-4 border-indigo-400 text-start text-base font-medium text-indigo-700 bg-indigo-50 focus:outline-none focus:text-indigo-800 focus:bg-indigo-100 focus:border-indigo-700 transition duration-150 ease-in-out'
            : 'block w-full ps-3 pe-4 py-2 border-l-4 border-transparent text-start text-base font-medium text-gray-600 hover:text-gray-800 hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300 transition duration-150 ease-in-out';
@endphp

<a {{ $attributes->merge(['class' => $classes]) }}>
    {{ $slot }}
</a>


### FILE: src/resources/views/components/secondary-button.blade.php
<button {{ $attributes->merge(['type' => 'button', 'class' => 'inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-25 transition ease-in-out duration-150']) }}>
    {{ $slot }}
</button>


### FILE: src/resources/views/components/site-header.blade.php
<header class="bg-white shadow-sm sticky top-0 z-50 h-16">
    <div class="max-w-7xl mx-auto px-4 h-full flex items-center justify-between gap-2 sm:gap-4">
        
        <div class="flex-shrink-0">
            <a href="{{ route('home') }}" class="font-bold text-2xl text-orange-500 tracking-tighter flex items-center gap-2">
                <span class="text-3xl">🍜</span>
                <span class="hidden lg:inline">tabelogg</span>
            </a>
        </div>

        <div class="flex flex-grow max-w-2xl mx-2 sm:mx-4">
            <form action="{{ route('restaurants.index') }}" method="GET" class="w-full flex rounded-md shadow-sm border border-gray-300 overflow-hidden focus-within:ring-2 focus-within:ring-orange-500 focus-within:border-orange-500 bg-gray-50">
                
                <div class="relative w-24 sm:w-32 flex-shrink-0 border-r border-gray-200">
                    <select name="prefecture_id" class="w-full h-full py-2 pl-2 sm:pl-3 pr-6 sm:pr-8 text-xs sm:text-sm bg-transparent border-none focus:ring-0 text-gray-700 cursor-pointer truncate">
                        <option value="">エリア</option>
                        @if(isset($headerPrefectures))
                            @foreach($headerPrefectures as $pref)
                                <option value="{{ $pref->id }}" {{ request('prefecture_id') == $pref->id ? 'selected' : '' }}>
                                    {{ $pref->name }}
                                </option>
                            @endforeach
                        @endif
                    </select>
                </div>

                <input type="text" name="keyword" value="{{ request('keyword') }}" placeholder="店名など" class="flex-grow py-2 px-2 sm:px-4 text-xs sm:text-sm border-none focus:ring-0 text-gray-700 placeholder-gray-400 min-w-0">

                <button type="submit" class="bg-orange-100 hover:bg-orange-200 text-orange-600 px-3 sm:px-4 flex items-center justify-center transition border-l border-gray-200 flex-shrink-0">
                    <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </button>
            </form>
        </div>

        <div class="flex-shrink-0 flex items-center space-x-2 sm:space-x-4">
            @auth
                <div class="flex items-center gap-3">
                    
                    {{-- ユーザー名（PCのみ表示） --}}
                    <span class="text-sm font-bold text-gray-700 hidden lg:inline truncate max-w-[100px]">{{ Auth::user()->name }}さん</span>

                    {{-- ★ここを変更：アイコン付き「マイページ」ボタン --}}
                    {{-- flex items-center gap-1 でアイコンと文字を横並びに --}}
                    <a href="{{ route('dashboard') }}" class="flex items-center gap-1.5 bg-gray-100 hover:bg-orange-100 text-gray-700 hover:text-orange-600 px-3 py-1.5 rounded-full transition duration-300 shadow-sm border border-gray-200 hover:border-orange-200">
                        {{-- 左側のアイコン --}}
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                        {{-- 右側の文字 --}}
                        <span class="text-xs sm:text-sm font-bold whitespace-nowrap">マイページ</span>
                    </a>

                    {{-- ログアウトボタン --}}
                    <form method="POST" action="{{ route('logout') }}">
                        @csrf
                        <button type="submit" class="text-xs sm:text-sm text-gray-400 hover:text-red-500 font-bold transition whitespace-nowrap pt-1">
                            ログアウト
                        </button>
                    </form>
                </div>
            @else
                <a href="{{ route('login') }}" class="text-xs sm:text-sm text-gray-600 hover:text-orange-500 font-bold transition whitespace-nowrap">ログイン</a>
                <a href="{{ route('register') }}" class="text-xs sm:text-sm bg-orange-500 hover:bg-orange-600 text-white font-bold py-1.5 px-3 sm:py-2 sm:px-4 rounded-full transition shadow-md whitespace-nowrap">登録</a>
            @endauth
        </div>
    </div>
</header>

### FILE: src/resources/views/components/text-input.blade.php
@props(['disabled' => false])

<input {{ $disabled ? 'disabled' : '' }} {!! $attributes->merge(['class' => 'border-gray-300 focus:border-orange-500 focus:ring-orange-500 rounded-md shadow-sm']) !!}>

### FILE: src/resources/views/dashboard.blade.php
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>マイページ - tabelogg</title>
    @vite(['resources/css/app.css', 'resources/js/app.js'])
</head>
<body class="bg-gray-50 text-gray-800">

    <x-site-header />

    <main class="py-10">
        <div class="max-w-7xl mx-auto px-6 sm:px-12 lg:px-20 space-y-8">
            
            <h1 class="text-3xl font-bold text-gray-900 border-b pb-4">マイページ</h1>
            
            {{-- 成功メッセージの表示 --}}
            @if(session('success'))
                <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
                    <span class="block sm:inline">{{ session('success') }}</span>
                </div>
            @endif

            {{-- ▼ 1. 店舗オーナー向け機能エリア ▼ --}}
            @auth
                @if(Auth::user()->isStoreOwner())
                    
                    {{-- 新規登録ボタン --}}
                    <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg border-l-4 border-orange-500 mb-8">
                        <div class="p-6 text-gray-900 flex flex-col sm:flex-row justify-between items-center gap-4">
                            <div>
                                <h3 class="font-bold text-lg mb-1">あなたのお店を掲載しませんか？</h3>
                                <p class="text-sm text-gray-500">簡単3ステップでお店を登録できます。</p>
                            </div>
                            <a href="{{ route('restaurants.create') }}" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-full shadow-md transition flex items-center gap-2 whitespace-nowrap">
                                <span>🏪</span> 新しい店舗を登録する
                            </a>
                        </div>
                    </div>

                    {{-- 自分の店舗一覧 --}}
                    <div class="bg-white rounded-lg shadow-md overflow-hidden mb-8">
                        <div class="p-6 bg-orange-50 border-b border-orange-100">
                            <h3 class="font-bold text-lg text-orange-800 flex items-center gap-2">
                                <span>🏠</span> あなたの掲載店舗管理
                            </h3>
                        </div>
                        <div class="p-6">
                            @if(Auth::user()->restaurants->isEmpty())
                                <p class="text-gray-400 text-sm text-center py-4">登録されている店舗はありません。</p>
                            @else
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    @foreach(Auth::user()->restaurants as $myRestaurant)
                                        <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition flex items-start gap-4 bg-white">
                                            {{-- 画像サムネイル --}}
                                            <div class="w-20 h-20 bg-gray-100 rounded overflow-hidden flex-shrink-0 border border-gray-200">
                                                @if($myRestaurant->images->isNotEmpty())
                                                    <img src="{{ asset('storage/' . $myRestaurant->images->first()->image_path) }}" class="w-full h-full object-cover">
                                                @else
                                                    <div class="w-full h-full flex items-center justify-center text-2xl bg-gray-50">🍜</div>
                                                @endif
                                            </div>
                                            
                                            <div class="flex-grow">
                                                <h4 class="font-bold text-lg mb-1">
                                                    <a href="{{ route('restaurants.show', $myRestaurant->id) }}" class="hover:text-orange-500 hover:underline">
                                                        {{ $myRestaurant->name }}
                                                    </a>
                                                </h4>
                                                <p class="text-xs text-gray-500 mb-2">
                                                    📍 {{ $myRestaurant->city->prefecture->name }} {{ $myRestaurant->city->name }}
                                                </p>
                                                
                                                <div class="flex items-center gap-2 mt-3">
                                                    {{-- 確認ボタン --}}
                                                    <a href="{{ route('restaurants.show', $myRestaurant->id) }}" class="text-xs bg-gray-800 text-white px-3 py-2 rounded hover:bg-gray-700 transition shadow-sm font-bold">
                                                        確認する
                                                    </a>
                                                    
                                                    {{-- 削除ボタン --}}
                                                    <form action="{{ route('restaurants.destroy', $myRestaurant->id) }}" method="POST" onsubmit="return confirm('本当にこの店舗を削除しますか？\n削除すると元に戻せません。');" class="inline-block">
                                                        @csrf
                                                        @method('DELETE')
                                                        <button type="submit" class="text-xs bg-red-600 text-white px-3 py-2 rounded hover:bg-red-700 transition shadow-sm font-bold border border-red-700">
                                                            削除する
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    @endforeach
                                </div>
                            @endif
                        </div>
                    </div>

                @endif
            @endauth

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                
                {{-- ▼ 2. お気に入り店舗一覧 ▼ --}}
                <div class="bg-white rounded-lg shadow-md h-full overflow-hidden">
                    <div class="p-6 bg-gray-50 border-b border-gray-100">
                        <h3 class="font-bold text-lg text-gray-800 flex items-center gap-2">
                            <span>❤️</span> お気に入り店舗
                        </h3>
                    </div>
                    <div class="p-6">
                        @if(Auth::user()->favorites->isEmpty())
                            <p class="text-gray-400 text-sm text-center py-4">まだお気に入りのお店はありません。</p>
                        @else
                            <ul class="space-y-4">
                                @foreach(Auth::user()->favorites as $favorite)
                                    @if($favorite->restaurant)
                                        <li class="flex items-center gap-4 p-3 hover:bg-gray-50 rounded-lg transition border border-gray-100">
                                            <div class="flex-1">
                                                <a href="{{ route('restaurants.show', $favorite->restaurant->id) }}" class="font-bold text-blue-600 hover:underline block mb-1">
                                                    {{ $favorite->restaurant->name }}
                                                </a>
                                                <p class="text-xs text-gray-500 bg-gray-100 inline-block px-2 py-1 rounded">
                                                    {{ $favorite->restaurant->city->prefecture->name }} {{ $favorite->restaurant->city->name }}
                                                </p>
                                            </div>
                                            <form action="{{ route('favorites.destroy', $favorite->restaurant->id) }}" method="POST">
                                                @csrf
                                                @method('DELETE')
                                                <button type="submit" class="text-xs text-red-500 hover:text-white hover:bg-red-500 border border-red-500 px-3 py-1.5 rounded transition">解除</button>
                                            </form>
                                        </li>
                                    @endif
                                @endforeach
                            </ul>
                        @endif
                    </div>
                </div>

                {{-- ▼ 3. 投稿したレビュー履歴 ▼ --}}
                <div class="bg-white rounded-lg shadow-md h-full overflow-hidden">
                    <div class="p-6 bg-gray-50 border-b border-gray-100">
                        <h3 class="font-bold text-lg text-gray-800 flex items-center gap-2">
                            <span>📝</span> 投稿したレビュー
                        </h3>
                    </div>
                    <div class="p-6">
                        @if(Auth::user()->reviews->isEmpty())
                            <p class="text-gray-400 text-sm text-center py-4">まだ投稿したレビューはありません。</p>
                        @else
                            <ul class="space-y-6">
                                @foreach(Auth::user()->reviews as $review)
                                    @if($review->restaurant)
                                        <li class="border-b border-gray-100 last:border-0 pb-4">
                                            <div class="flex justify-between items-start mb-2">
                                                <a href="{{ route('restaurants.show', $review->restaurant->id) }}" class="font-bold text-sm text-gray-800 hover:text-orange-500">
                                                    {{ $review->restaurant->name }}
                                                </a>
                                                <span class="text-xs text-gray-400">{{ $review->created_at->format('Y/m/d') }}</span>
                                            </div>
                                            <div class="flex items-center text-xs text-yellow-500 mb-2">
                                                {{ str_repeat('★', $review->rating) }}
                                                <span class="text-gray-300">{{ str_repeat('★', 5 - $review->rating) }}</span>
                                            </div>
                                            <p class="text-sm text-gray-600 line-clamp-2 bg-gray-50 p-2 rounded mb-2">{{ $review->comment }}</p>
                                            
                                            {{-- ★★★ 追加：レビュー削除ボタン ★★★ --}}
                                            <div class="flex justify-end">
                                                <form action="{{ route('reviews.destroy', $review->id) }}" method="POST" onsubmit="return confirm('本当にこのレビューを削除しますか？');">
                                                    @csrf
                                                    @method('DELETE')
                                                    <button type="submit" class="text-xs text-red-500 hover:text-red-700 hover:underline">
                                                        🗑️ 削除する
                                                    </button>
                                                </form>
                                            </div>
                                        </li>
                                    @endif
                                @endforeach
                            </ul>
                        @endif
                    </div>
                </div>

            </div>
        </div>
    </main>

</body>
</html>

### FILE: src/resources/views/layouts/app.blade.php
<!DOCTYPE html>
<html lang="{{ str_replace('_', '-', app()->getLocale()) }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="csrf-token" content="{{ csrf_token() }}">

        <title>{{ config('app.name', 'Laravel') }}</title>

        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.bunny.net">
        <link href="https://fonts.bunny.net/css?family=figtree:400,500,600&display=swap" rel="stylesheet" />

        <!-- Scripts -->
        @vite(['resources/css/app.css', 'resources/js/app.js'])
    </head>
    <body class="font-sans antialiased">
        <div class="min-h-screen bg-gray-100">
            @include('layouts.navigation')

            <!-- Page Heading -->
            @isset($header)
                <header class="bg-white shadow">
                    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
                        {{ $header }}
                    </div>
                </header>
            @endisset

            <!-- Page Content -->
            <main>
                {{ $slot }}
            </main>
        </div>
    </body>
</html>


### FILE: src/resources/views/layouts/guest.blade.php
<!DOCTYPE html>
<html lang="{{ str_replace('_', '-', app()->getLocale()) }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="csrf-token" content="{{ csrf_token() }}">

        <title>{{ config('app.name', 'Laravel') }}</title>

        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.bunny.net">
        <link href="https://fonts.bunny.net/css?family=figtree:400,500,600&display=swap" rel="stylesheet" />

        <!-- Scripts -->
        @vite(['resources/css/app.css', 'resources/js/app.js'])
    </head>
    <body class="font-sans text-gray-900 antialiased">
        <div class="min-h-screen flex flex-col sm:justify-center items-center pt-6 sm:pt-0 bg-gray-100">
            <div>
                <a href="/">
                    <x-application-logo class="w-20 h-20 fill-current text-gray-500" />
                </a>
            </div>

            <div class="w-full sm:max-w-md mt-6 px-6 py-4 bg-white shadow-md overflow-hidden sm:rounded-lg">
                {{ $slot }}
            </div>
        </div>
    </body>
</html>


### FILE: src/resources/views/layouts/navigation.blade.php
<nav x-data="{ open: false }" class="bg-white border-b border-gray-100">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
            <div class="flex">
                <div class="shrink-0 flex items-center">
                    <a href="{{ route('home') }}">
                        <x-application-logo class="block h-9 w-auto fill-current text-gray-800" />
                    </a>
                </div>

                <div class="hidden space-x-8 sm:-my-px sm:ms-10 sm:flex">
                    <x-nav-link :href="route('restaurants.index')" :active="request()->routeIs('restaurants.index')">
                        店舗一覧
                    </x-nav-link>
                    
                    @auth
                        <x-nav-link :href="route('dashboard')" :active="request()->routeIs('dashboard')">
                            ダッシュボード
                        </x-nav-link>
                    @endauth
                </div>
            </div>

            <div class="hidden sm:flex sm:items-center sm:ms-6">
                @auth
                    {{-- ★ログインしている場合：ユーザー名とドロップダウンを表示 --}}
                    <x-dropdown align="right" width="48">
                        <x-slot name="trigger">
                            <button class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-gray-500 bg-white hover:text-gray-700 focus:outline-none transition ease-in-out duration-150">
                                <div>{{ Auth::user()->name }}</div>

                                <div class="ms-1">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </button>
                        </x-slot>

                        <x-slot name="content">
                            @if(Auth::user()->role_id === 3)
                                <x-dropdown-link :href="route('admin.dashboard')">
                                    管理者メニュー
                                </x-dropdown-link>
                            @endif

                            <x-dropdown-link :href="route('profile.edit')">
                                {{ __('Profile') }}
                            </x-dropdown-link>

                            <form method="POST" action="{{ route('logout') }}">
                                @csrf
                                <x-dropdown-link :href="route('logout')"
                                        onclick="event.preventDefault();
                                                    this.closest('form').submit();">
                                    {{ __('Log Out') }}
                                </x-dropdown-link>
                            </form>
                        </x-slot>
                    </x-dropdown>
                @else
                    {{-- ★ログインしていない場合：ログイン・登録ボタンを表示 --}}
                    <div class="space-x-4">
                        <a href="{{ route('login') }}" class="text-sm text-gray-700 hover:text-orange-500 font-bold">ログイン</a>
                        <a href="{{ route('register') }}" class="text-sm bg-orange-500 text-white px-4 py-2 rounded-full hover:bg-orange-600 transition font-bold">新規登録</a>
                    </div>
                @endauth
            </div>

            <div class="-me-2 flex items-center sm:hidden">
                <button @click="open = ! open" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-150 ease-in-out">
                    <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                        <path :class="{'hidden': open, 'inline-flex': ! open }" class="inline-flex" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        <path :class="{'hidden': ! open, 'inline-flex': open }" class="hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <div :class="{'block': open, 'hidden': ! open}" class="hidden sm:hidden">
        <div class="pt-2 pb-3 space-y-1">
            <x-responsive-nav-link :href="route('restaurants.index')" :active="request()->routeIs('restaurants.index')">
                店舗一覧
            </x-responsive-nav-link>
            
            @auth
                <x-responsive-nav-link :href="route('dashboard')" :active="request()->routeIs('dashboard')">
                    ダッシュボード
                </x-responsive-nav-link>
            @endauth
        </div>

        <div class="pt-4 pb-1 border-t border-gray-200">
            @auth
                {{-- ★スマホ版：ログイン時 --}}
                <div class="px-4">
                    <div class="font-medium text-base text-gray-800">{{ Auth::user()->name }}</div>
                    <div class="font-medium text-sm text-gray-500">{{ Auth::user()->email }}</div>
                </div>

                <div class="mt-3 space-y-1">
                    @if(Auth::user()->role_id === 3)
                        <x-responsive-nav-link :href="route('admin.dashboard')">
                            管理者メニュー
                        </x-responsive-nav-link>
                    @endif

                    <x-responsive-nav-link :href="route('profile.edit')">
                        {{ __('Profile') }}
                    </x-responsive-nav-link>

                    <form method="POST" action="{{ route('logout') }}">
                        @csrf
                        <x-responsive-nav-link :href="route('logout')"
                                onclick="event.preventDefault();
                                            this.closest('form').submit();">
                            {{ __('Log Out') }}
                        </x-responsive-nav-link>
                    </form>
                </div>
            @else
                {{-- ★スマホ版：未ログイン時 --}}
                <div class="mt-3 space-y-1">
                    <x-responsive-nav-link :href="route('login')">
                        ログイン
                    </x-responsive-nav-link>
                    <x-responsive-nav-link :href="route('register')">
                        新規登録
                    </x-responsive-nav-link>
                </div>
            @endauth
        </div>
    </div>
</nav>

### FILE: src/resources/views/owner/dashboard.blade.php
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ $restaurant->name }} - 管理ダッシュボード</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    
    <header class="bg-white shadow">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <h1 class="text-3xl font-bold text-gray-900">
                {{ $restaurant->name }} 管理画面
            </h1>
            <a href="{{ route('reservations.create', $restaurant->id) }}" target="_blank" class="text-blue-600 hover:text-blue-900">
                予約フォームを確認 &rarr;
            </a>
        </div>
    </header>

    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        
        <div class="flex flex-col">
            <div class="-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
                <div class="py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8">
                    
                    <h2 class="text-xl font-semibold mb-4 text-gray-700">今後の予約一覧</h2>

                    @if($reservations->isEmpty())
                        <div class="bg-white p-6 rounded shadow text-center text-gray-500">
                            現在、予約はありません。
                        </div>
                    @else
                        <div class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            来店日時
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            お名前
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            席タイプ
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            人数
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            終了予定
                                        </th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    @foreach ($reservations as $reservation)
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-bold text-gray-900">
                                                {{ $reservation->reserved_at->format('Y/m/d (D)') }}
                                            </div>
                                            <div class="text-sm text-gray-500">
                                                {{ $reservation->reserved_at->format('H:i') }} 〜
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900">
                                                {{ $reservation->user->name ?? 'ゲスト' }} 様
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                                {{ str_contains($reservation->seatType->name, 'カウンター') ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800' }}">
                                                {{ $reservation->seatType->name }}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            {{ $reservation->number_of_people }}名
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            {{ $reservation->end_at->format('H:i') }}
                                        </td>
                                    </tr>
                                    @endforeach
                                </tbody>
                            </table>
                        </div>
                    @endif
                </div>
            </div>
        </div>
    </main>
</body>
</html>

### FILE: src/resources/views/profile/edit.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('Profile') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6">
            <div class="p-4 sm:p-8 bg-white shadow sm:rounded-lg">
                <div class="max-w-xl">
                    @include('profile.partials.update-profile-information-form')
                </div>
            </div>

            <div class="p-4 sm:p-8 bg-white shadow sm:rounded-lg">
                <div class="max-w-xl">
                    @include('profile.partials.update-password-form')
                </div>
            </div>

            <div class="p-4 sm:p-8 bg-white shadow sm:rounded-lg">
                <div class="max-w-xl">
                    @include('profile.partials.delete-user-form')
                </div>
            </div>
        </div>
    </div>
</x-app-layout>


### FILE: src/resources/views/profile/partials/delete-user-form.blade.php
<section class="space-y-6">
    <header>
        <h2 class="text-lg font-medium text-gray-900">
            {{ __('Delete Account') }}
        </h2>

        <p class="mt-1 text-sm text-gray-600">
            {{ __('Once your account is deleted, all of its resources and data will be permanently deleted. Before deleting your account, please download any data or information that you wish to retain.') }}
        </p>
    </header>

    <x-danger-button
        x-data=""
        x-on:click.prevent="$dispatch('open-modal', 'confirm-user-deletion')"
    >{{ __('Delete Account') }}</x-danger-button>

    <x-modal name="confirm-user-deletion" :show="$errors->userDeletion->isNotEmpty()" focusable>
        <form method="post" action="{{ route('profile.destroy') }}" class="p-6">
            @csrf
            @method('delete')

            <h2 class="text-lg font-medium text-gray-900">
                {{ __('Are you sure you want to delete your account?') }}
            </h2>

            <p class="mt-1 text-sm text-gray-600">
                {{ __('Once your account is deleted, all of its resources and data will be permanently deleted. Please enter your password to confirm you would like to permanently delete your account.') }}
            </p>

            <div class="mt-6">
                <x-input-label for="password" value="{{ __('Password') }}" class="sr-only" />

                <x-text-input
                    id="password"
                    name="password"
                    type="password"
                    class="mt-1 block w-3/4"
                    placeholder="{{ __('Password') }}"
                />

                <x-input-error :messages="$errors->userDeletion->get('password')" class="mt-2" />
            </div>

            <div class="mt-6 flex justify-end">
                <x-secondary-button x-on:click="$dispatch('close')">
                    {{ __('Cancel') }}
                </x-secondary-button>

                <x-danger-button class="ms-3">
                    {{ __('Delete Account') }}
                </x-danger-button>
            </div>
        </form>
    </x-modal>
</section>


### FILE: src/resources/views/profile/partials/update-password-form.blade.php
<section>
    <header>
        <h2 class="text-lg font-medium text-gray-900">
            {{ __('Update Password') }}
        </h2>

        <p class="mt-1 text-sm text-gray-600">
            {{ __('Ensure your account is using a long, random password to stay secure.') }}
        </p>
    </header>

    <form method="post" action="{{ route('password.update') }}" class="mt-6 space-y-6">
        @csrf
        @method('put')

        <div>
            <x-input-label for="update_password_current_password" :value="__('Current Password')" />
            <x-text-input id="update_password_current_password" name="current_password" type="password" class="mt-1 block w-full" autocomplete="current-password" />
            <x-input-error :messages="$errors->updatePassword->get('current_password')" class="mt-2" />
        </div>

        <div>
            <x-input-label for="update_password_password" :value="__('New Password')" />
            <x-text-input id="update_password_password" name="password" type="password" class="mt-1 block w-full" autocomplete="new-password" />
            <x-input-error :messages="$errors->updatePassword->get('password')" class="mt-2" />
        </div>

        <div>
            <x-input-label for="update_password_password_confirmation" :value="__('Confirm Password')" />
            <x-text-input id="update_password_password_confirmation" name="password_confirmation" type="password" class="mt-1 block w-full" autocomplete="new-password" />
            <x-input-error :messages="$errors->updatePassword->get('password_confirmation')" class="mt-2" />
        </div>

        <div class="flex items-center gap-4">
            <x-primary-button>{{ __('Save') }}</x-primary-button>

            @if (session('status') === 'password-updated')
                <p
                    x-data="{ show: true }"
                    x-show="show"
                    x-transition
                    x-init="setTimeout(() => show = false, 2000)"
                    class="text-sm text-gray-600"
                >{{ __('Saved.') }}</p>
            @endif
        </div>
    </form>
</section>


### FILE: src/resources/views/profile/partials/update-profile-information-form.blade.php
<section>
    <header>
        <h2 class="text-lg font-medium text-gray-900">
            {{ __('Profile Information') }}
        </h2>

        <p class="mt-1 text-sm text-gray-600">
            {{ __("Update your account's profile information and email address.") }}
        </p>
    </header>

    <form id="send-verification" method="post" action="{{ route('verification.send') }}">
        @csrf
    </form>

    <form method="post" action="{{ route('profile.update') }}" class="mt-6 space-y-6">
        @csrf
        @method('patch')

        <div>
            <x-input-label for="name" :value="__('Name')" />
            <x-text-input id="name" name="name" type="text" class="mt-1 block w-full" :value="old('name', $user->name)" required autofocus autocomplete="name" />
            <x-input-error class="mt-2" :messages="$errors->get('name')" />
        </div>

        <div>
            <x-input-label for="email" :value="__('Email')" />
            <x-text-input id="email" name="email" type="email" class="mt-1 block w-full" :value="old('email', $user->email)" required autocomplete="username" />
            <x-input-error class="mt-2" :messages="$errors->get('email')" />

            @if ($user instanceof \Illuminate\Contracts\Auth\MustVerifyEmail && ! $user->hasVerifiedEmail())
                <div>
                    <p class="text-sm mt-2 text-gray-800">
                        {{ __('Your email address is unverified.') }}

                        <button form="send-verification" class="underline text-sm text-gray-600 hover:text-gray-900 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            {{ __('Click here to re-send the verification email.') }}
                        </button>
                    </p>

                    @if (session('status') === 'verification-link-sent')
                        <p class="mt-2 font-medium text-sm text-green-600">
                            {{ __('A new verification link has been sent to your email address.') }}
                        </p>
                    @endif
                </div>
            @endif
        </div>

        <div class="flex items-center gap-4">
            <x-primary-button>{{ __('Save') }}</x-primary-button>

            @if (session('status') === 'profile-updated')
                <p
                    x-data="{ show: true }"
                    x-show="show"
                    x-transition
                    x-init="setTimeout(() => show = false, 2000)"
                    class="text-sm text-gray-600"
                >{{ __('Saved.') }}</p>
            @endif
        </div>
    </form>
</section>


### FILE: src/resources/views/reservations/create.blade.php
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ $restaurant->name }} - 予約</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 py-10">
    <div class="max-w-2xl mx-auto bg-white p-8 rounded shadow">
        
        <h1 class="text-2xl font-bold mb-6">{{ $restaurant->name }} 予約フォーム</h1>

        @if (session('success'))
            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                {{ session('success') }}
            </div>
        @endif

        @if ($errors->any())
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                <ul>
                    @foreach ($errors->all() as $error)
                        <li>・{{ $error }}</li>
                    @endforeach
                </ul>
            </div>
        @endif

        <form action="{{ route('reservations.store', $restaurant->id) }}" method="POST">
            @csrf

            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2">日付</label>
                <input type="date" name="reservation_date" value="{{ old('reservation_date') }}" 
                    class="w-full border p-2 rounded">
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2">時間</label>
                <input type="time" name="reservation_time" value="{{ old('reservation_time') }}" 
                    class="w-full border p-2 rounded">
                <p class="text-sm text-gray-500 mt-1">
                    ※ ランチ: 11:00〜14:00 (60分制) <br>
                    ※ ディナー: 17:00〜23:00 (120分制)
                </p>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-bold mb-2">席タイプ</label>
                <select name="seat_type_id" class="w-full border p-2 rounded">
                    <option value="">選択してください</option>
                    @foreach ($seatTypes as $seatType)
                        <option value="{{ $seatType->id }}" {{ old('seat_type_id') == $seatType->id ? 'selected' : '' }}>
                            {{ $seatType->name }} (定員: {{ $seatType->capacity }})
                        </option>
                    @endforeach
                </select>
                <p class="text-sm text-gray-500 mt-1">※お一人様でもテーブル席を選ぶとテーブル枠が消費されます</p>
            </div>

            <div class="mb-6">
                <label class="block text-gray-700 font-bold mb-2">人数</label>
                <input type="number" name="number_of_people" min="1" value="{{ old('number_of_people', 1) }}" 
                    class="w-full border p-2 rounded">
            </div>

            <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded hover:bg-blue-700 transition">
                予約を確定する
            </button>
        </form>
    </div>
</body>
</html>

### FILE: src/resources/views/restaurants/create.blade.php
<x-app-layout>
    <x-slot name="header">
        <h2 class="font-semibold text-xl text-gray-800 leading-tight">
            {{ __('新しいお店を登録') }}
        </h2>
    </x-slot>

    <div class="py-12">
        <div class="max-w-3xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 text-gray-900">
                    
                    {{-- エラー表示 --}}
                    @if ($errors->any())
                        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                            <ul>
                                @foreach ($errors->all() as $error)
                                    <li>・{{ $error }}</li>
                                @endforeach
                            </ul>
                        </div>
                    @endif

                    <form action="{{ route('restaurants.store') }}" method="POST" enctype="multipart/form-data">
                        @csrf
                        
                        {{-- 店舗名 --}}
                        <div class="mb-6">
                            <label class="block text-gray-700 font-bold mb-2">店舗名 <span class="text-red-500">*</span></label>
                            <input type="text" name="name" class="w-full border-gray-300 rounded-md shadow-sm focus:border-orange-500 focus:ring-orange-500" placeholder="例：中華そば 太郎" required>
                        </div>

                        {{-- エリア選択 --}}
                        <div class="mb-6">
                            <label class="block text-gray-700 font-bold mb-2">エリア <span class="text-red-500">*</span></label>
                            <select name="city_id" class="w-full border-gray-300 rounded-md shadow-sm focus:border-orange-500 focus:ring-orange-500">
                                @foreach($prefectures as $prefecture)
                                    <optgroup label="{{ $prefecture->name }}">
                                        @foreach($prefecture->cities as $city)
                                            <option value="{{ $city->id }}">{{ $city->name }}</option>
                                        @endforeach
                                    </optgroup>
                                @endforeach
                            </select>
                        </div>

                        {{-- ★★★ 追加：住所（必須） ★★★ --}}
                        <div class="mb-6">
                            <label class="block text-gray-700 font-bold mb-2">住所詳細 <span class="text-red-500">*</span></label>
                            <input type="text" name="address" class="w-full border-gray-300 rounded-md shadow-sm focus:border-orange-500 focus:ring-orange-500" placeholder="例：1-2-3 ○○ビル1F" required>
                            <p class="text-xs text-gray-500 mt-1">※市区町村以降の住所を入力してください</p>
                        </div>

                        {{-- 最寄駅 --}}
                        <div class="mb-6">
                            <label class="block text-gray-700 font-bold mb-2">最寄駅（任意）</label>
                            <input type="text" name="nearest_station" class="w-full border-gray-300 rounded-md shadow-sm focus:border-orange-500 focus:ring-orange-500" placeholder="例：JR新宿駅 東口徒歩5分">
                        </div>

                        {{-- お店の紹介 --}}
                        <div class="mb-6">
                            <label class="block text-gray-700 font-bold mb-2">お店の紹介 <span class="text-red-500">*</span></label>
                            <textarea name="description" rows="5" class="w-full border-gray-300 rounded-md shadow-sm focus:border-orange-500 focus:ring-orange-500" placeholder="お店のこだわりや特徴を入力してください" required></textarea>
                        </div>

                        {{-- メニュー情報 --}}
                        <div class="mb-6">
                            <label class="block text-gray-700 font-bold mb-2">おすすめメニュー・価格など（任意）</label>
                            <textarea name="menu_info" rows="4" class="w-full border-gray-300 rounded-md shadow-sm focus:border-orange-500 focus:ring-orange-500" placeholder="例：&#13;&#10;特製醤油ラーメン 850円&#13;&#10;半チャーハン 300円"></textarea>
                        </div>

                        {{-- 画像アップロード --}}
                        <div class="mb-8">
                            <label class="block text-gray-700 font-bold mb-2">店舗・メニュー画像（複数可）</label>
                            <input type="file" name="images[]" multiple class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-200 file:text-orange-800 hover:file:bg-orange-300 cursor-pointer">
                        </div>

                        <div class="flex justify-center gap-4">
                            <a href="{{ route('dashboard') }}" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-full transition">キャンセル</a>
                            <button type="submit" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-8 rounded-full shadow-lg transition">登録する</button>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
</x-app-layout>

### FILE: src/resources/views/restaurants/index.blade.php
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>お店一覧 - tabelogg</title>
    @vite(['resources/css/app.css', 'resources/js/app.js'])
</head>
<body class="bg-gray-50 text-gray-800">

    <x-site-header />

    <main class="py-10">
        <div class="max-w-7xl mx-auto px-6 sm:px-12 lg:px-20">
            
            {{-- ★★★ 修正箇所：ヘッダーエリア（タイトル・並び替え・登録ボタン） ★★★ --}}
            <div class="flex flex-col md:flex-row justify-between items-end md:items-center mb-6 gap-4">
                
                {{-- 左側：タイトルと並び替え --}}
                <div class="flex items-center gap-4 w-full md:w-auto">
                    <h2 class="text-xl font-bold text-gray-800 whitespace-nowrap">
                        @if(request('keyword') || request('prefecture_id'))
                            {{-- paginateを使っているため total() で全件数を取得 --}}
                            検索結果: {{ $restaurants->total() }} 件
                        @else
                            すべてのお店
                        @endif
                    </h2>

                    {{-- 並び替えドロップダウン --}}
                    <div class="relative">
                        <select id="sort-select" onchange="changeSort(this.value)" 
                                class="text-sm border-gray-300 rounded-md shadow-sm focus:border-orange-500 focus:ring-orange-500 cursor-pointer py-1 pl-3 pr-8">
                            <option value="" {{ !request('sort') ? 'selected' : '' }}>新着順</option>
                            <option value="nearest" {{ request('sort') === 'nearest' ? 'selected' : '' }}>📍 現在地に近い</option>
                            <option value="rating" {{ request('sort') === 'rating' ? 'selected' : '' }}>⭐️ 評価が高い</option>
                            <option value="favorites" {{ request('sort') === 'favorites' ? 'selected' : '' }}>🔖 人気順</option>
                            <option value="reviews" {{ request('sort') === 'reviews' ? 'selected' : '' }}>💬 口コミ数</option>
                        </select>
                    </div>
                </div>
                
                {{-- 右側：店舗オーナー用ボタン --}}
                @auth
                    @if(Auth::user()->isStoreOwner())
                        <a href="{{ route('restaurants.create') }}" class="inline-flex items-center px-4 py-2 bg-gray-800 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-700 transition shadow whitespace-nowrap">
                            <span class="mr-1 text-lg">➕</span> 新しいお店を登録
                        </a>
                    @endif
                @endauth
            </div>

            {{-- 店舗一覧リスト --}}
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                @forelse($restaurants as $restaurant)
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition duration-300 border border-gray-100 flex flex-col h-full group">
                        
                        {{-- 画像エリア --}}
                        <div class="h-48 bg-gray-200 flex items-center justify-center relative overflow-hidden">
                            @if($restaurant->images->isNotEmpty())
                                <img src="{{ asset('storage/' . $restaurant->images->first()->image_path) }}" 
                                     alt="{{ $restaurant->name }}" 
                                     class="w-full h-full object-cover transform group-hover:scale-110 transition duration-500">
                            @else
                                <span class="text-4xl">🍜</span>
                            @endif

                            <a href="{{ route('restaurants.show', $restaurant->id) }}" class="absolute inset-0 z-10"></a>
                        </div>

                        <div class="p-5 flex-grow flex flex-col justify-between">
                            <div>
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="text-xl font-bold text-gray-800 line-clamp-1">
                                        <a href="{{ route('restaurants.show', $restaurant->id) }}" class="hover:text-orange-500 transition">
                                            {{ $restaurant->name }}
                                        </a>
                                    </h3>
                                    <span class="bg-orange-100 text-orange-600 text-xs px-2 py-1 rounded-full whitespace-nowrap ml-2">
                                        {{ $restaurant->city->prefecture->name }}
                                    </span>
                                </div>
                                
                                <p class="text-gray-600 text-sm mb-4 line-clamp-2">
                                    {{ $restaurant->description }}
                                </p>
                            </div>

                            <div class="flex justify-between items-center border-t pt-3 mt-2">
                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                    {{-- 評価（コントローラーで集計済みの reviews_avg_rating を優先利用し、無ければ計算） --}}
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-1 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                        {{ number_format($restaurant->reviews_avg_rating ?? $restaurant->reviews->avg('rating') ?? 0, 1) }}
                                    </span>
                                    
                                    {{-- お気に入り数（favorites_count を優先利用） --}}
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-1 text-red-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path></svg>
                                        {{ $restaurant->favorites_count ?? $restaurant->favorites->count() }}
                                    </span>
                                </div>
                                <a href="{{ route('restaurants.show', $restaurant->id) }}" class="text-orange-500 hover:text-orange-600 text-sm font-bold">詳細へ &rarr;</a>
                            </div>
                        </div>
                    </div>
                @empty
                    <div class="col-span-full text-center py-10 text-gray-500">
                        <p>条件に一致するお店は見つかりませんでした。</p>
                        <a href="{{ route('restaurants.index') }}" class="text-blue-500 hover:underline mt-2 inline-block">すべての表示に戻す</a>
                    </div>
                @endforelse
            </div>

            {{-- ★★★ 修正箇所：ページネーションリンクを追加 ★★★ --}}
            <div class="mt-8">
                {{ $restaurants->links() }}
            </div>
            
        </div>
    </main>

    {{-- ★★★ 修正箇所：並び替え用JavaScript ★★★ --}}
    <script>
        function changeSort(sortValue) {
            const url = new URL(window.location.href);
            
            // 「現在地」が選ばれた時だけ位置情報を取得
            if (sortValue === 'nearest') {
                if (!navigator.geolocation) {
                    alert('このブラウザは位置情報に対応していません。');
                    document.getElementById('sort-select').value = ""; 
                    return;
                }

                // ボタンなどをローディング状態にするとなお良い
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        url.searchParams.set('sort', 'nearest');
                        url.searchParams.set('lat', lat);
                        url.searchParams.set('lng', lng);
                        window.location.href = url.toString();
                    },
                    (error) => {
                        alert('位置情報の取得に失敗しました。');
                        document.getElementById('sort-select').value = "";
                    }
                );
            } else {
                // それ以外は通常の並び替え（位置情報はクリアする）
                url.searchParams.set('sort', sortValue);
                url.searchParams.delete('lat');
                url.searchParams.delete('lng');
                window.location.href = url.toString();
            }
        }
    </script>
</body>
</html>

### FILE: src/resources/views/restaurants/show.blade.php
<x-app-layout>
    <x-site-header />

    <main class="py-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            
            {{-- 戻るリンク --}}
            <div class="mb-6">
                <a href="{{ route('restaurants.index') }}" class="text-blue-600 hover:underline">← 一覧に戻る</a>
            </div>

            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                
                {{-- ========================================== --}}
                {{-- ★★★ 上部エリア（固定表示） ★★★ --}}
                {{-- ========================================== --}}
                <div class="p-6 lg:p-10 border-b border-gray-100">
                    {{-- 店名と評価エリア --}}
                    <div class="mb-4">
                        <h1 class="text-3xl font-bold text-gray-900 mb-2">
                            {{ $restaurant->name }}
                        </h1>

                        <div class="flex items-end gap-6 flex-wrap">
                            {{-- 平均満足度 --}}
                            <div class="text-3xl font-bold text-orange-500 flex items-center">
                                <span class="mr-1 text-2xl">★</span>
                                {{ number_format($restaurant->reviews->avg('rating') ?? 0, 1) }}
                            </div>

                            {{-- 口コミ数とお気に入り数 --}}
                            <div class="text-base text-gray-600 flex items-center gap-6 mb-1">
                                <span class="flex items-center">
                                    <span class="mr-1">💬</span>
                                    <span class="font-bold">{{ $restaurant->reviews->count() }}</span>件
                                </span>
                                <span class="flex items-center">
                                    <span class="mr-1">🔖</span>
                                    <span class="font-bold">{{ $restaurant->favorites->count() }}</span>
                                </span>
                            </div>
                        </div>
                    </div>

                    {{-- 住所・エリアの簡易表示 --}}
                    <div class="text-gray-500 mb-6 flex items-center gap-2 text-sm">
                        <span>📍 {{ $restaurant->city->prefecture->name }}{{ $restaurant->city->name }}</span>
                        @if($restaurant->nearest_station)
                            <span class="border-l border-gray-300 pl-2 ml-1">🚃 {{ $restaurant->nearest_station }}</span>
                        @endif
                    </div>

                    {{-- お気に入りボタン --}}
                    @auth
                        <div>
                            @if($restaurant->favorites()->where('user_id', Auth::id())->exists())
                                <form action="{{ route('favorites.destroy', $restaurant->id) }}" method="POST">
                                    @csrf @method('DELETE')
                                    <button type="submit" class="bg-red-50 text-red-500 hover:bg-red-100 border border-red-200 px-6 py-2 rounded-full font-bold flex items-center gap-2 transition">
                                        ❤️ お気に入り解除
                                    </button>
                                </form>
                            @else
                                <form action="{{ route('favorites.store', $restaurant->id) }}" method="POST">
                                    @csrf
                                    <button type="submit" class="bg-gray-100 text-gray-500 hover:text-red-500 hover:bg-red-50 border border-gray-200 px-6 py-2 rounded-full font-bold flex items-center gap-2 transition">
                                        🤍 お気に入り登録
                                    </button>
                                </form>
                            @endif
                        </div>
                    @endauth
                </div>


                {{-- ========================================== --}}
                {{-- ★★★ タブリスト ★★★ --}}
                {{-- ========================================== --}}
                <div class="border-b border-gray-200">
                    <ul class="flex flex-wrap -mb-px text-sm font-medium text-center text-gray-500" id="myTab" role="tablist">
                        
                        {{-- トップ --}}
                        <li class="mr-2" role="presentation">
                            <button class="inline-block p-4 border-b-2 rounded-t-lg hover:text-gray-600 hover:border-gray-300 js-tab-trigger active-tab" 
                                    id="top-tab" data-target="top" type="button" role="tab">
                                トップ
                            </button>
                        </li>
                        
                        {{-- メニュー --}}
                        <li class="mr-2" role="presentation">
                            <button class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 js-tab-trigger" 
                                    id="menu-tab" data-target="menu" type="button" role="tab">
                                メニュー
                            </button>
                        </li>

                        {{-- レビュー --}}
                        <li class="mr-2" role="presentation">
                            <button class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 js-tab-trigger" 
                                    id="reviews-tab" data-target="reviews" type="button" role="tab">
                                レビュー <span class="bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs ml-1">{{ $restaurant->reviews->count() }}</span>
                            </button>
                        </li>

                        {{-- アクセス --}}
                        <li class="mr-2" role="presentation">
                            <button class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 js-tab-trigger" 
                                    id="access-tab" data-target="access" type="button" role="tab">
                                アクセス
                            </button>
                        </li>
                    </ul>
                </div>

                {{-- ========================================== --}}
                {{-- ★★★ タブコンテンツ ★★★ --}}
                {{-- ========================================== --}}
                <div id="myTabContent" class="p-6 lg:p-10 min-h-[400px]">
                    
                    {{-- 1. トップタブ --}}
                    <div class="js-tab-content block" id="top" role="tabpanel">
                        
                        {{-- 店舗画像 --}}
                        <div class="mb-8">
                            @if($restaurant->images->isNotEmpty())
                                @php
                                    $allImages = $restaurant->images->map(fn($img) => asset('storage/' . $img->image_path));
                                    $firstImage = $restaurant->images->first();
                                @endphp

                                <div class="aspect-video w-full bg-gray-100 rounded-lg overflow-hidden border border-gray-200 relative group cursor-pointer shadow-sm js-modal-trigger"
                                     data-images="{{ json_encode($allImages) }}"
                                     onclick="openModalFromElement(this)">
                                    
                                    <img src="{{ asset('storage/' . $firstImage->image_path) }}" 
                                         class="w-full h-full object-contain transition duration-300"
                                         alt="店舗画像">
                                         
                                    <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition"></div>
                                    <div class="absolute bottom-4 right-4 bg-black/60 text-white text-xs px-3 py-1 rounded-full pointer-events-none">
                                        {{ $restaurant->images->count() }}枚の写真
                                    </div>
                                </div>
                            @else
                                <div class="aspect-video bg-gray-50 rounded-lg flex flex-col items-center justify-center text-gray-400 border border-gray-200 border-dashed">
                                    <span class="text-4xl mb-2">📷</span>
                                    <p>画像は登録されていません</p>
                                </div>
                            @endif
                        </div>

                        {{-- お店の紹介 --}}
                        <div>
                            <h2 class="text-xl font-bold text-gray-800 mb-4 border-l-4 border-orange-500 pl-3">お店の紹介</h2>
                            <p class="text-gray-700 leading-loose whitespace-pre-wrap">{{ $restaurant->description }}</p>
                        </div>
                    </div>


                    {{-- 2. メニュータブ --}}
                    <div class="js-tab-content hidden" id="menu" role="tabpanel">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 border-l-4 border-orange-500 pl-3">メニュー・価格情報</h2>
                        @if($restaurant->menu_info)
                            <div class="bg-orange-50 border border-orange-100 p-6 rounded-lg text-gray-700 leading-relaxed whitespace-pre-wrap">
                                {{ $restaurant->menu_info }}
                            </div>
                        @else
                            <p class="text-gray-500">メニュー情報はまだ登録されていません。</p>
                        @endif
                    </div>


                    {{-- 3. レビュータブ --}}
                    <div class="js-tab-content hidden" id="reviews" role="tabpanel">
                        
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {{-- 左側：投稿フォーム --}}
                            <div class="lg:col-span-1">
                                <div class="bg-gray-50 p-6 rounded-lg border border-gray-200 sticky top-4">
                                    <h3 class="font-bold mb-4 text-gray-800">レビューを書く</h3>
                                    @auth
                                        <form action="{{ route('reviews.store', $restaurant->id) }}" method="POST" enctype="multipart/form-data">
                                            @csrf
                                            <div class="mb-4">
                                                <label class="block text-sm font-bold mb-1 text-gray-700">評価</label>
                                                <select name="rating" class="w-full border-gray-300 rounded-md shadow-sm focus:border-orange-500 focus:ring-orange-500">
                                                    <option value="5" selected>⭐️⭐️⭐️⭐️⭐️ 5</option>
                                                    <option value="4">⭐️⭐️⭐️⭐️ 4</option>
                                                    <option value="3">⭐️⭐️⭐️ 3</option>
                                                    <option value="2">⭐️⭐️ 2</option>
                                                    <option value="1">⭐️ 1</option>
                                                </select>
                                            </div>
                                            <div class="mb-4">
                                                <label class="block text-sm font-bold mb-1 text-gray-700">コメント</label>
                                                <textarea name="comment" rows="4" class="w-full border-gray-300 rounded-md shadow-sm focus:border-orange-500 focus:ring-orange-500" placeholder="感想を教えてください"></textarea>
                                            </div>
                                            <div class="mb-4">
                                                <label class="block text-sm font-bold mb-1 text-gray-700">画像</label>
                                                <input type="file" name="images[]" multiple class="w-full text-sm text-gray-500 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-orange-100 file:text-orange-700 hover:file:bg-orange-200">
                                            </div>
                                            <button type="submit" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-full transition shadow-md">
                                                投稿する
                                            </button>
                                        </form>
                                    @else
                                        <p class="text-sm text-gray-500 mb-4">レビューを投稿するにはログインが必要です。</p>
                                        <a href="{{ route('login') }}" class="block text-center border border-orange-500 text-orange-500 font-bold py-2 rounded-full hover:bg-orange-50">ログイン</a>
                                    @endauth
                                </div>
                            </div>

                            {{-- 右側：レビュー一覧 --}}
                            <div class="lg:col-span-2">
                                <h3 class="font-bold mb-4 text-gray-800 text-lg">新着レビュー</h3>
                                @if($restaurant->reviews->isEmpty())
                                    <div class="text-center py-10 bg-gray-50 rounded-lg text-gray-500">
                                        まだレビューはありません。<br>最初の投稿者になりましょう！
                                    </div>
                                @else
                                    <div class="space-y-6">
                                        @foreach($restaurant->reviews as $review)
                                            <div class="border-b border-gray-100 pb-6 last:border-0">
                                                <div class="flex justify-between items-center mb-2">
                                                    <div class="flex items-center gap-2">
                                                        <span class="font-bold text-gray-800">👤 {{ $review->user->name }}</span>
                                                        <span class="text-yellow-500 text-sm">
                                                            {{ str_repeat('★', $review->rating) }}<span class="text-gray-300">{{ str_repeat('★', 5 - $review->rating) }}</span>
                                                        </span>
                                                    </div>
                                                    <span class="text-xs text-gray-400">{{ $review->created_at->format('Y/m/d') }}</span>
                                                </div>
                                                <p class="text-gray-700 text-sm leading-relaxed whitespace-pre-wrap mb-3">{{ $review->comment }}</p>
                                                
                                                @if($review->images->isNotEmpty())
                                                    @php
                                                        $reviewImages = $review->images->map(fn($img) => asset('storage/' . $img->image_path));
                                                        $firstReviewImage = $review->images->first();
                                                    @endphp

                                                    <div class="mt-3 w-full md:w-3/4 aspect-video bg-gray-100 rounded-lg overflow-hidden border border-gray-200 relative group cursor-pointer shadow-sm js-modal-trigger"
                                                         data-images="{{ json_encode($reviewImages) }}"
                                                         onclick="openModalFromElement(this)">
                                                        <img src="{{ asset('storage/' . $firstReviewImage->image_path) }}" class="w-full h-full object-contain bg-gray-50" alt="レビュー画像">
                                                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition"></div>
                                                        @if($review->images->count() > 1)
                                                            <div class="absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded pointer-events-none">
                                                                +{{ $review->images->count() - 1 }}
                                                            </div>
                                                        @endif
                                                    </div>
                                                @endif

                                                @if(Auth::id() === $review->user_id)
                                                    <form action="{{ route('reviews.destroy', $review->id) }}" method="POST" class="mt-2 text-right" onsubmit="return confirm('削除しますか？');">
                                                        @csrf @method('DELETE')
                                                        <button class="text-xs text-red-400 hover:text-red-600 hover:underline">削除する</button>
                                                    </form>
                                                @endif
                                            </div>
                                        @endforeach
                                    </div>
                                @endif
                            </div>
                        </div>
                    </div>


                    {{-- 4. アクセスタブ --}}
                    <div class="js-tab-content hidden" id="access" role="tabpanel">
                        <h2 class="text-xl font-bold text-gray-800 mb-6 border-l-4 border-orange-500 pl-3">店舗へのアクセス</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <p class="text-xs text-gray-500 font-bold mb-1">住所</p>
                                    <p class="text-lg">{{ $restaurant->address }}</p>
                                </div>
                                
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <p class="text-xs text-gray-500 font-bold mb-1">最寄り駅</p>
                                    <p class="text-lg">
                                        {{ $restaurant->nearest_station ?? '情報なし' }}
                                    </p>
                                </div>

                                <div class="pt-4">
                                    <a href="https://www.google.com/maps/search/?api=1&query={{ urlencode($restaurant->address) }}" target="_blank" class="inline-flex items-center text-blue-600 hover:underline font-bold">
                                        <span class="mr-2">🗺️</span> Googleマップで開く
                                    </a>
                                </div>
                            </div>
                            
                            {{-- ★★★ Googleマップ埋め込みエリア ★★★ --}}
                            <div class="h-[300px] w-full bg-gray-100 rounded-lg overflow-hidden shadow-sm border border-gray-200">
                                @php
                                    // 緯度経度があればそれを優先、なければ住所を使用
                                    $mapQuery = urlencode($restaurant->address);
                                    if ($restaurant->latitude && $restaurant->longitude) {
                                        $mapQuery = "{$restaurant->latitude},{$restaurant->longitude}";
                                    }
                                @endphp
                                <iframe 
                                    src="https://maps.google.com/maps?q={{ $mapQuery }}&output=embed&t=m&z=15"
                                    width="100%" 
                                    height="100%" 
                                    style="border:0;" 
                                    allowfullscreen="" 
                                    loading="lazy">
                                </iframe>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </main>

    {{-- モーダル --}}
    <div id="image-modal" class="fixed inset-0 z-50 bg-black/95 hidden flex items-center justify-center p-4" onclick="if(event.target === this) closeModal()">
        <button onclick="closeModal()" class="fixed top-6 right-6 z-[60] bg-white rounded-full p-3 text-black shadow-lg hover:bg-gray-200 transition">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
        <button id="prev-btn" onclick="prevImage()" class="hidden fixed left-4 top-1/2 -translate-y-1/2 z-[60] bg-white rounded-full p-4 text-black shadow-lg hover:bg-gray-200 transition transform hover:scale-110">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"></path></svg>
        </button>
        <div class="relative w-full max-w-7xl h-full flex items-center justify-center mx-auto pointer-events-none">
            <img id="modal-image" src="" class="max-w-full max-h-[90vh] object-contain select-none shadow-2xl rounded pointer-events-auto">
        </div>
        <button id="next-btn" onclick="nextImage()" class="hidden fixed right-4 top-1/2 -translate-y-1/2 z-[60] bg-white rounded-full p-4 text-black shadow-lg hover:bg-gray-200 transition transform hover:scale-110">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7"></path></svg>
        </button>
    </div>

    {{-- スタイルとスクリプト --}}
    <style>
        .active-tab {
            color: #f97316 !important; /* text-orange-500 */
            border-bottom-color: #f97316 !important; /* border-orange-500 */
        }
    </style>

    <script>
        // タブ切り替え
        document.addEventListener('DOMContentLoaded', function () {
            const tabs = document.querySelectorAll('.js-tab-trigger');
            const contents = document.querySelectorAll('.js-tab-content');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetId = tab.getAttribute('data-target');
                    tabs.forEach(t => t.classList.remove('active-tab', 'border-orange-500', 'text-orange-600'));
                    tabs.forEach(t => t.classList.add('border-transparent'));
                    contents.forEach(c => c.classList.add('hidden'));
                    contents.forEach(c => c.classList.remove('block'));
                    tab.classList.add('active-tab');
                    tab.classList.remove('border-transparent');
                    document.getElementById(targetId).classList.remove('hidden');
                    document.getElementById(targetId).classList.add('block');
                });
            });
        });

        // モーダル機能
        let currentImages = [];
        let currentIndex = 0;
        function openModalFromElement(element) {
            const imagesJson = element.getAttribute('data-images');
            if(imagesJson) {
                const images = JSON.parse(imagesJson);
                openModal(images, 0); 
            }
        }
        function openModal(images, index = 0) {
            if(!images || images.length === 0) return;
            currentImages = images;
            currentIndex = index;
            updateImage();
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            if (currentImages.length > 1) {
                prevBtn.classList.remove('hidden');
                nextBtn.classList.remove('hidden');
            } else {
                prevBtn.classList.add('hidden');
                nextBtn.classList.add('hidden');
            }
            document.getElementById('image-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        function closeModal() { 
            document.getElementById('image-modal').classList.add('hidden'); 
            document.body.style.overflow = 'auto';
        }
        function updateImage() { 
            document.getElementById('modal-image').src = currentImages[currentIndex];
        }
        function nextImage() { currentIndex = (currentIndex + 1) % currentImages.length; updateImage(); }
        function prevImage() { currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length; updateImage(); }
        document.addEventListener('keydown', function(e) {
            const modal = document.getElementById('image-modal');
            if (modal.classList.contains('hidden')) return;
            if (currentImages.length > 1) {
                if (e.key === 'ArrowRight') nextImage();
                if (e.key === 'ArrowLeft') prevImage();
            }
            if (e.key === 'Escape') closeModal();
        });
    </script>
</x-app-layout>

### FILE: src/routes/auth.php
<?php

use App\Http\Controllers\Auth\AuthenticatedSessionController;
use App\Http\Controllers\Auth\ConfirmablePasswordController;
use App\Http\Controllers\Auth\EmailVerificationNotificationController;
use App\Http\Controllers\Auth\EmailVerificationPromptController;
use App\Http\Controllers\Auth\NewPasswordController;
use App\Http\Controllers\Auth\PasswordController;
use App\Http\Controllers\Auth\PasswordResetLinkController;
use App\Http\Controllers\Auth\RegisteredUserController;
use App\Http\Controllers\Auth\VerifyEmailController;
use Illuminate\Support\Facades\Route;

Route::middleware('guest')->group(function () {
    Route::get('register', [RegisteredUserController::class, 'create'])
        ->name('register');

    Route::post('register', [RegisteredUserController::class, 'store']);

    Route::get('login', [AuthenticatedSessionController::class, 'create'])
        ->name('login');

    Route::post('login', [AuthenticatedSessionController::class, 'store']);

    Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])
        ->name('password.request');

    Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])
        ->name('password.email');

    Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])
        ->name('password.reset');

    Route::post('reset-password', [NewPasswordController::class, 'store'])
        ->name('password.store');
});

Route::middleware('auth')->group(function () {
    Route::get('verify-email', EmailVerificationPromptController::class)
        ->name('verification.notice');

    Route::get('verify-email/{id}/{hash}', VerifyEmailController::class)
        ->middleware(['signed', 'throttle:6,1'])
        ->name('verification.verify');

    Route::post('email/verification-notification', [EmailVerificationNotificationController::class, 'store'])
        ->middleware('throttle:6,1')
        ->name('verification.send');

    Route::get('confirm-password', [ConfirmablePasswordController::class, 'show'])
        ->name('password.confirm');

    Route::post('confirm-password', [ConfirmablePasswordController::class, 'store']);

    Route::put('password', [PasswordController::class, 'update'])->name('password.update');

    Route::post('logout', [AuthenticatedSessionController::class, 'destroy'])
        ->name('logout');
});


### FILE: src/routes/console.php
<?php

use Illuminate\Foundation\Inspiring;
use Illuminate\Support\Facades\Artisan;

Artisan::command('inspire', function () {
    $this->comment(Inspiring::quote());
})->purpose('Display an inspiring quote');


### FILE: src/routes/web.php
<?php

use App\Http\Controllers\ProfileController;
use App\Http\Controllers\RestaurantController;
use App\Http\Controllers\ReviewController;
use App\Http\Controllers\FavoriteController;
use App\Http\Controllers\AdminController; // 追加
use Illuminate\Support\Facades\Route;
use App\Http\Controllers\ReservationController; // ★ファイルの上のほうに追加
use App\Http\Controllers\OwnerController; // ★ファイルの上のほうに追加

/*
|--------------------------------------------------------------------------
| 一般公開ルート (一覧など)
|--------------------------------------------------------------------------
*/
Route::get('/', [RestaurantController::class, 'index'])->name('home');
Route::get('/restaurants', [RestaurantController::class, 'index'])->name('restaurants.index');

/*
|--------------------------------------------------------------------------
| 認証済みユーザー用ルート
|--------------------------------------------------------------------------
*/
Route::get('/dashboard', function () {
    return view('dashboard');
})->middleware(['auth', 'verified'])->name('dashboard');

Route::middleware('auth')->group(function () {
    Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');
    Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');
    Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');

    Route::post('/restaurants/{id}/reviews', [ReviewController::class, 'store'])->name('reviews.store');
    Route::delete('/reviews/{review}', [ReviewController::class, 'destroy'])->name('reviews.destroy');
    Route::post('/restaurants/{id}/favorites', [FavoriteController::class, 'store'])->name('favorites.store');
    Route::delete('/restaurants/{id}/favorites', [FavoriteController::class, 'destroy'])->name('favorites.destroy');
});

/*
|--------------------------------------------------------------------------
| 店舗オーナー専用ルート (create は {id} より前に書く！)
|--------------------------------------------------------------------------
*/
Route::middleware(['auth', 'owner'])->group(function () {
    // ★ ここにある create が先に判定されるのでOKになります
    Route::get('/restaurants/create', [RestaurantController::class, 'create'])->name('restaurants.create');
    Route::post('/restaurants', [RestaurantController::class, 'store'])->name('restaurants.store');
    Route::delete('/restaurants/{id}', [RestaurantController::class, 'destroy'])->name('restaurants.destroy');
});

/*
|--------------------------------------------------------------------------
| 管理者専用ルート
|--------------------------------------------------------------------------
*/
Route::prefix('admin')->middleware(['auth', 'admin'])->group(function () {
    Route::get('/dashboard', [AdminController::class, 'index'])->name('admin.dashboard');
    Route::delete('/users/{id}', [AdminController::class, 'destroyUser'])->name('admin.users.destroy');
    Route::delete('/restaurants/{id}', [AdminController::class, 'destroyRestaurant'])->name('admin.restaurants.destroy');
    Route::delete('/reviews/{id}', [AdminController::class, 'destroyReview'])->name('admin.reviews.destroy');
});


/*

*/
// ここを一番下に持ってくることで、上の create などに当てはまらなかった場合のみ、ここに来るようになります。
Route::get('/restaurants/{id}', [RestaurantController::class, 'show'])->name('restaurants.show');

// 予約フォームを表示（後で作ります）
Route::get('/restaurants/{restaurant}/reservations/create', [ReservationController::class, 'create'])->name('reservations.create');

// 予約実行（今回実装するメインロジック）
Route::post('/restaurants/{restaurant}/reservations', [ReservationController::class, 'store'])->name('reservations.store');

// 店舗管理ダッシュボード
Route::get('/owner/restaurants/{restaurant}/dashboard', [OwnerController::class, 'dashboard'])->name('owner.dashboard');
require __DIR__.'/auth.php';

### FILE: src/tailwind.config.js
import defaultTheme from 'tailwindcss/defaultTheme';
import forms from '@tailwindcss/forms';

/** @type {import('tailwindcss').Config} */
export default {
    content: [
        './vendor/laravel/framework/src/Illuminate/Pagination/resources/views/*.blade.php',
        './storage/framework/views/*.php',
        './resources/views/**/*.blade.php',
    ],

    theme: {
        extend: {
            fontFamily: {
                sans: ['Figtree', ...defaultTheme.fontFamily.sans],
            },
        },
    },

    plugins: [forms],
};


### FILE: src/tests/Feature/Auth/AuthenticationTest.php
<?php

namespace Tests\Feature\Auth;

use App\Models\User;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class AuthenticationTest extends TestCase
{
    use RefreshDatabase;

    public function test_login_screen_can_be_rendered(): void
    {
        $response = $this->get('/login');

        $response->assertStatus(200);
    }

    public function test_users_can_authenticate_using_the_login_screen(): void
    {
        $user = User::factory()->create();

        $response = $this->post('/login', [
            'email' => $user->email,
            'password' => 'password',
        ]);

        $this->assertAuthenticated();
        $response->assertRedirect(route('dashboard', absolute: false));
    }

    public function test_users_can_not_authenticate_with_invalid_password(): void
    {
        $user = User::factory()->create();

        $this->post('/login', [
            'email' => $user->email,
            'password' => 'wrong-password',
        ]);

        $this->assertGuest();
    }

    public function test_users_can_logout(): void
    {
        $user = User::factory()->create();

        $response = $this->actingAs($user)->post('/logout');

        $this->assertGuest();
        $response->assertRedirect('/');
    }
}


### FILE: src/tests/Feature/Auth/EmailVerificationTest.php
<?php

namespace Tests\Feature\Auth;

use App\Models\User;
use Illuminate\Auth\Events\Verified;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Illuminate\Support\Facades\Event;
use Illuminate\Support\Facades\URL;
use Tests\TestCase;

class EmailVerificationTest extends TestCase
{
    use RefreshDatabase;

    public function test_email_verification_screen_can_be_rendered(): void
    {
        $user = User::factory()->unverified()->create();

        $response = $this->actingAs($user)->get('/verify-email');

        $response->assertStatus(200);
    }

    public function test_email_can_be_verified(): void
    {
        $user = User::factory()->unverified()->create();

        Event::fake();

        $verificationUrl = URL::temporarySignedRoute(
            'verification.verify',
            now()->addMinutes(60),
            ['id' => $user->id, 'hash' => sha1($user->email)]
        );

        $response = $this->actingAs($user)->get($verificationUrl);

        Event::assertDispatched(Verified::class);
        $this->assertTrue($user->fresh()->hasVerifiedEmail());
        $response->assertRedirect(route('dashboard', absolute: false).'?verified=1');
    }

    public function test_email_is_not_verified_with_invalid_hash(): void
    {
        $user = User::factory()->unverified()->create();

        $verificationUrl = URL::temporarySignedRoute(
            'verification.verify',
            now()->addMinutes(60),
            ['id' => $user->id, 'hash' => sha1('wrong-email')]
        );

        $this->actingAs($user)->get($verificationUrl);

        $this->assertFalse($user->fresh()->hasVerifiedEmail());
    }
}


### FILE: src/tests/Feature/Auth/PasswordConfirmationTest.php
<?php

namespace Tests\Feature\Auth;

use App\Models\User;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class PasswordConfirmationTest extends TestCase
{
    use RefreshDatabase;

    public function test_confirm_password_screen_can_be_rendered(): void
    {
        $user = User::factory()->create();

        $response = $this->actingAs($user)->get('/confirm-password');

        $response->assertStatus(200);
    }

    public function test_password_can_be_confirmed(): void
    {
        $user = User::factory()->create();

        $response = $this->actingAs($user)->post('/confirm-password', [
            'password' => 'password',
        ]);

        $response->assertRedirect();
        $response->assertSessionHasNoErrors();
    }

    public function test_password_is_not_confirmed_with_invalid_password(): void
    {
        $user = User::factory()->create();

        $response = $this->actingAs($user)->post('/confirm-password', [
            'password' => 'wrong-password',
        ]);

        $response->assertSessionHasErrors();
    }
}


### FILE: src/tests/Feature/Auth/PasswordResetTest.php
<?php

namespace Tests\Feature\Auth;

use App\Models\User;
use Illuminate\Auth\Notifications\ResetPassword;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Illuminate\Support\Facades\Notification;
use Tests\TestCase;

class PasswordResetTest extends TestCase
{
    use RefreshDatabase;

    public function test_reset_password_link_screen_can_be_rendered(): void
    {
        $response = $this->get('/forgot-password');

        $response->assertStatus(200);
    }

    public function test_reset_password_link_can_be_requested(): void
    {
        Notification::fake();

        $user = User::factory()->create();

        $this->post('/forgot-password', ['email' => $user->email]);

        Notification::assertSentTo($user, ResetPassword::class);
    }

    public function test_reset_password_screen_can_be_rendered(): void
    {
        Notification::fake();

        $user = User::factory()->create();

        $this->post('/forgot-password', ['email' => $user->email]);

        Notification::assertSentTo($user, ResetPassword::class, function ($notification) {
            $response = $this->get('/reset-password/'.$notification->token);

            $response->assertStatus(200);

            return true;
        });
    }

    public function test_password_can_be_reset_with_valid_token(): void
    {
        Notification::fake();

        $user = User::factory()->create();

        $this->post('/forgot-password', ['email' => $user->email]);

        Notification::assertSentTo($user, ResetPassword::class, function ($notification) use ($user) {
            $response = $this->post('/reset-password', [
                'token' => $notification->token,
                'email' => $user->email,
                'password' => 'password',
                'password_confirmation' => 'password',
            ]);

            $response
                ->assertSessionHasNoErrors()
                ->assertRedirect(route('login'));

            return true;
        });
    }
}


### FILE: src/tests/Feature/Auth/PasswordUpdateTest.php
<?php

namespace Tests\Feature\Auth;

use App\Models\User;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Illuminate\Support\Facades\Hash;
use Tests\TestCase;

class PasswordUpdateTest extends TestCase
{
    use RefreshDatabase;

    public function test_password_can_be_updated(): void
    {
        $user = User::factory()->create();

        $response = $this
            ->actingAs($user)
            ->from('/profile')
            ->put('/password', [
                'current_password' => 'password',
                'password' => 'new-password',
                'password_confirmation' => 'new-password',
            ]);

        $response
            ->assertSessionHasNoErrors()
            ->assertRedirect('/profile');

        $this->assertTrue(Hash::check('new-password', $user->refresh()->password));
    }

    public function test_correct_password_must_be_provided_to_update_password(): void
    {
        $user = User::factory()->create();

        $response = $this
            ->actingAs($user)
            ->from('/profile')
            ->put('/password', [
                'current_password' => 'wrong-password',
                'password' => 'new-password',
                'password_confirmation' => 'new-password',
            ]);

        $response
            ->assertSessionHasErrorsIn('updatePassword', 'current_password')
            ->assertRedirect('/profile');
    }
}


### FILE: src/tests/Feature/Auth/RegistrationTest.php
<?php

namespace Tests\Feature\Auth;

use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class RegistrationTest extends TestCase
{
    use RefreshDatabase;

    public function test_registration_screen_can_be_rendered(): void
    {
        $response = $this->get('/register');

        $response->assertStatus(200);
    }

    public function test_new_users_can_register(): void
    {
        $response = $this->post('/register', [
            'name' => 'Test User',
            'email' => 'test@example.com',
            'password' => 'password',
            'password_confirmation' => 'password',
        ]);

        $this->assertAuthenticated();
        $response->assertRedirect(route('dashboard', absolute: false));
    }
}


### FILE: src/tests/Feature/ExampleTest.php
<?php

namespace Tests\Feature;

// use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class ExampleTest extends TestCase
{
    /**
     * A basic test example.
     */
    public function test_the_application_returns_a_successful_response(): void
    {
        $response = $this->get('/');

        $response->assertStatus(200);
    }
}


### FILE: src/tests/Feature/ProfileTest.php
<?php

namespace Tests\Feature;

use App\Models\User;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class ProfileTest extends TestCase
{
    use RefreshDatabase;

    public function test_profile_page_is_displayed(): void
    {
        $user = User::factory()->create();

        $response = $this
            ->actingAs($user)
            ->get('/profile');

        $response->assertOk();
    }

    public function test_profile_information_can_be_updated(): void
    {
        $user = User::factory()->create();

        $response = $this
            ->actingAs($user)
            ->patch('/profile', [
                'name' => 'Test User',
                'email' => 'test@example.com',
            ]);

        $response
            ->assertSessionHasNoErrors()
            ->assertRedirect('/profile');

        $user->refresh();

        $this->assertSame('Test User', $user->name);
        $this->assertSame('test@example.com', $user->email);
        $this->assertNull($user->email_verified_at);
    }

    public function test_email_verification_status_is_unchanged_when_the_email_address_is_unchanged(): void
    {
        $user = User::factory()->create();

        $response = $this
            ->actingAs($user)
            ->patch('/profile', [
                'name' => 'Test User',
                'email' => $user->email,
            ]);

        $response
            ->assertSessionHasNoErrors()
            ->assertRedirect('/profile');

        $this->assertNotNull($user->refresh()->email_verified_at);
    }

    public function test_user_can_delete_their_account(): void
    {
        $user = User::factory()->create();

        $response = $this
            ->actingAs($user)
            ->delete('/profile', [
                'password' => 'password',
            ]);

        $response
            ->assertSessionHasNoErrors()
            ->assertRedirect('/');

        $this->assertGuest();
        $this->assertNull($user->fresh());
    }

    public function test_correct_password_must_be_provided_to_delete_account(): void
    {
        $user = User::factory()->create();

        $response = $this
            ->actingAs($user)
            ->from('/profile')
            ->delete('/profile', [
                'password' => 'wrong-password',
            ]);

        $response
            ->assertSessionHasErrorsIn('userDeletion', 'password')
            ->assertRedirect('/profile');

        $this->assertNotNull($user->fresh());
    }
}


### FILE: src/tests/TestCase.php
<?php

namespace Tests;

use Illuminate\Foundation\Testing\TestCase as BaseTestCase;

abstract class TestCase extends BaseTestCase
{
    //
}


### FILE: src/tests/Unit/ExampleTest.php
<?php

namespace Tests\Unit;

use PHPUnit\Framework\TestCase;

class ExampleTest extends TestCase
{
    /**
     * A basic test example.
     */
    public function test_that_true_is_true(): void
    {
        $this->assertTrue(true);
    }
}


### FILE: src/vite.config.js
import { defineConfig } from 'vite';
import laravel from 'laravel-vite-plugin';

export default defineConfig({
    plugins: [
        laravel({
            input: ['resources/css/app.css', 'resources/js/app.js'],
            refresh: true,
        }),
    ],
});


